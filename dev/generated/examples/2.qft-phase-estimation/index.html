<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   -0.364551+0.120601im       0.04259+0.131474im       0.0666952-0.00958301im   -0.0153108-0.155271im    0.0182911-0.078767im   -0.0521778+0.0370062im     0.177588-0.00379972im   -0.0745644-0.281288im     -0.0502543+0.219174im       0.101435-0.292967im     0.0913887+0.0778797im    0.0724827+0.0770134im     0.101196+0.223513im      -0.241988+0.054591im     0.0102614-0.0742im         0.0429433-0.134379im     -0.0602927+0.2003im        -0.174549+0.0795889im   -0.0456796+0.0387013im     0.0367547+0.113953im    -0.0170945+0.0645819im    0.0132737+0.00837357im     0.221537+0.181304im      0.0448785+0.0928209im      0.086522+0.0787377im   0.0207883-0.0739651im    0.0738293-0.198515im       0.0528373-0.122586im       0.111532+0.0975495im    -0.0120752+0.118214im      0.123595-0.0182822im    -0.132091+0.104928im
  -0.0846186-0.224338im     -0.189256+0.103117im       -0.190522+0.0344799im      0.136541-0.0665535im  -0.0506066-0.0462487im    0.346346-0.0389448im    -0.163054-0.141097im      0.0872906-0.11226im        0.083837+0.206584im       0.162416-0.0951967im   -0.0558579+0.0598226im   -0.0344111+0.00477711im   0.0831276-0.114024im      -0.077354+0.156804im     0.0227625-0.137336im      -0.0982586+0.062431im     -0.0264707-0.0444644im     0.0388597+0.0239317im    -0.175431-0.0155513im    -0.0243981-0.140657im     -0.203442-0.0366314im     0.170079+0.10013im       0.0609865-0.0126123im     0.0243632-0.182216im     -0.0472844-0.16523im    -0.0704588-0.0151479im   -0.0951313-0.0132215im       0.010547-0.0737633im     -0.100401+0.0665897im      0.159026+0.200272im    -0.0395763+0.0521578im     0.396127+0.00215972im
    0.257029-0.0761961im  -0.00702546-0.0443913im      -0.371788+0.173981im      0.0318323-0.102398im     0.264916+0.0570411im   0.0210435-0.0111583im     0.140638-0.368159im     -0.0219053-0.230622im     -0.0491465-0.0217718im    -0.0432945-0.104705im    -0.0169631+0.18631im       0.046186-0.0596731im    -0.176238+0.229683im       0.102646+0.0361536im   -0.0920465-0.0176369im     -0.0241727+0.117523im        0.15462+0.0181545im     0.0190536-0.0534961im     0.081231+0.00764249im     0.094489-0.00617047im  -0.0381393-0.0595537im   0.00739724-0.160645im      0.0258053+0.156629im     -0.0350619+0.0678134im    -0.0189743-0.127022im   -0.0619907+0.139115im     0.0425609+0.169553im      -0.0970935-0.0413201im       0.14928-0.142296im      0.0485931-0.07261im       0.176879+0.0851337im    -0.107536+0.0353351im
   -0.206449-0.0688518im    -0.104316+0.00680667im     0.0744569+0.173193im      -0.291512+0.271887im     0.122493+0.123835im     0.127418+0.0414415im    0.0123351-0.0598616im     0.0504349-0.0603893im    -0.0589998+0.0641303im     0.0347794+0.135349im      0.147106-0.0954576im   -0.0271524-0.106021im     -0.131408-0.0241114im     0.0157233+0.0254582im    0.0353257+0.271877im      -0.0548199-0.232754im      0.0744424+0.169006im      -0.061885-0.100337im    -0.0511339-0.0508505im    -0.0175247+0.165511im     0.0577537-0.0054878im     0.148021-0.278484im     -0.0191705-0.126752im      0.0171652+0.072397im     -0.0416368-0.202857im   -0.0570492-0.238964im    -0.0670598+0.000661255im    -0.122816+0.0303314im     0.0787738+0.128897im      -0.106822-0.132033im    0.00662885+0.216833im      0.170553+0.104161im
    0.269602-0.17289im     -0.0600913-0.0119518im      0.0370291+0.00539503im  -0.00272958+0.0537795im   -0.248822-0.143148im   -0.0812226+0.0361915im     0.203684+0.0591933im     0.0746346-0.187748im       0.239269-0.0186902im     0.0167814-0.053251im        0.1877+0.385899im    -0.0486365-0.0278022im     0.359197-0.113645im      -0.204017+0.00252512im    0.139447+0.0454782im      -0.030905-0.114607im      0.0802154+0.0518111im      0.019944+0.0101314im    0.0133944-0.0114717im     0.0275866+0.084548im     0.0295591-0.0665073im   -0.0897504-0.0722037im     0.0175173-0.081131im     -0.0558342-0.032771im    -0.00234524+0.116664im   0.00352667+0.0698092im    0.0399893+0.230642im      -0.0683298+0.0719289im     0.0666099+0.172922im      -0.151125-0.141231im   -0.00713157+0.0951794im    0.0820512-0.149943im
   0.0438612-0.197914im      0.138072-0.0612363im      0.0619847-0.00468754im   -0.0924555+0.157501im    -0.095716+0.139066im    -0.183599+0.219846im    -0.0696328-0.0133113im     0.0121318-0.188259im     -0.0106701-0.00921449im   -0.0460175-0.189383im      -0.23955-0.253133im     -0.116311+0.117557im     0.0598537+0.159088im        0.11701+0.1632im       -0.115436+0.146435im       0.0877109+0.179726im      0.0962445+0.301401im       0.070613+0.0859151im    0.0397175-0.239696im       0.016728+0.0410967im    -0.115588+0.0765098im   -0.0415273+0.0463759im      0.037944+0.0280714im     -0.090974-0.0422485im    -0.0601918-0.0917206im  -0.0547286+0.130517im    -0.0276874+0.0716763im     -0.0305012-0.00315368im     -0.12924+0.226482im      -0.149192+0.18048im     -0.0826112-0.112146im     0.0181011-0.162562im
    -0.19257-0.101335im    -0.0608191+0.151382im       -0.135232-0.175684im      -0.317488+0.0685388im  -0.0164517-0.162037im   0.00511138+0.107567im     0.0133728+0.118432im       0.241985-0.220728im      0.0965798+0.134048im      -0.168574+0.00533395im  -0.0302122-0.0982923im      0.11988-0.203461im     0.0124048-0.117822im       0.142913+0.0611667im     0.169773+0.0893562im     -0.0816447+0.0968961im    -0.0112687-0.0949651im    -0.0949289+0.0142267im   -0.0678287-0.138988im      0.0799519+0.0577491im     0.152994-0.156889im     -0.123115+0.0957916im     -0.123521+0.090135im     -0.0749259-0.0291636im     0.0036778+0.0837013im   0.0356213+0.145666im    -0.0134182-0.022019im       -0.153184-0.0834671im     -0.178469-0.183706im        0.24957-0.0818809im      0.15754-0.0238581im    -0.152023-0.0270808im
   -0.217655-0.196396im     0.0884941+0.00627906im     -0.205313-0.17354im      -0.0728555-0.101611im    0.0872256-0.133546im    -0.167817-0.105992im    0.00726049-0.151564im      -0.233279+0.112928im    -0.00750682+0.0880916im    -0.0423435+0.125529im     0.0249844+0.0245496im    0.0664052-0.0444091im   -0.0877133+0.166156im     -0.0873403-0.117659im      0.236886-0.0848168im     -0.0507737+0.191215im     -0.0509551+0.0225517im     0.0570334+0.0306979im    0.0557291-0.0841724im      0.146474-0.00481502im   0.0653071+0.1459im       -0.144276+0.0203013im      0.020468-0.197877im      0.0779264-0.165814im       0.211648-0.051653im    -0.241829-0.116761im     0.0339249+0.0713195im     -0.0143901+0.0603851im    -0.0404777+0.230439im      0.0437271-0.11553im      -0.285648+0.133231im    -0.0506785-0.102842im
  -0.0372799+0.0664084im     0.123673+0.0435421im      -0.112306+0.0797384im     0.0193488-0.0937889im   -0.087464+0.0901914im    0.228051+0.055184im     -0.189701+0.0629038im     0.0132235-0.0657549im     -0.239581-0.0504745im      -0.16257+0.0257642im    -0.074272-0.0639033im     0.165356+0.0207771im    0.0931247-0.119464im      -0.142804-0.344654im     0.0803331-0.0616038im      -0.156689+0.0710515im     0.0187973+0.317848im     0.00518691-0.12847im      0.0888331+0.128521im     -0.0733842+0.205156im    -0.0773305+0.0936369im    -0.103204+0.160986im      -0.057633-0.010234im     -0.0718137-0.0666528im    0.00587048+0.0972268im   -0.111717+0.0970852im     0.125189+0.0971189im      -0.263957-0.155573im        0.10154-0.132847im      -0.178501-0.063061im   -0.00304947-0.0543603im     0.170155+0.0835295im
  -0.0721091-0.162735im    -0.0813547-0.186794im       0.0535743-0.136353im      0.0181472+0.332737im    0.0584796-0.117579im   -0.0771536-0.230727im     0.0561019-0.0457609im     -0.111169-0.116862im      0.0247109-0.23326im      0.00200168+0.063148im     -0.125546-0.0122082im    0.0522602-0.0766135im   -0.0413134+0.0280218im     -0.146595+0.0300534im   -0.0725783+0.00845748im     -0.103829-0.0210599im    0.00547297-0.0183475im      -0.18542+0.0187036im     0.149628+0.201209im      -0.271468-0.263064im       0.18184+0.0902993im   -0.0208651+0.0415063im      0.133828-0.0504346im     -0.121067-0.126438im      0.0354227-0.0394952im    0.133701+0.165532im    -0.0152167-0.0259848im      -0.130078-0.350197im     0.00919332+0.0393886im    -0.0446705+0.126299im     0.0400668+0.0855627im   0.00770375+0.0957624im
   0.0168682-0.0920839im     -0.04013+0.193566im     -0.00604697-0.172804im      -0.131307+0.0712218im  -0.0679477-0.085881im     0.154627-0.164482im    -0.0795608-0.0491731im      -0.11998-0.0750984im      -0.22812-0.0767659im     0.0652089+0.0408301im    -0.227332+0.066114im     -0.276561-0.0445856im     0.313952-0.0306711im     0.0128814+0.0928545im    -0.167371-0.00695904im     0.0255273+0.0207455im     -0.015586+0.0540512im     -0.173478-0.00961994im    0.156478-0.0383907im      0.102008+0.00301339im   -0.014162+0.15607im       0.272728+0.0223879im     -0.305465-0.0474067im       0.25759+0.0503992im     0.0713631+0.0171682im  -0.0712099-0.0656414im    -0.019541+0.107502im        0.116632-0.0169551im      0.148722-0.0622555im     0.0258803-0.135538im     0.0713623-0.0768835im    -0.205086+0.00916207im
  -0.0604865+0.0977603im    -0.235349-0.0926989im      0.0373108+0.132084im      -0.066511-0.116905im     0.259863+0.0675972im  -0.0422597-0.0594145im     0.014688+0.0192283im      0.122695-0.0655707im    -0.0927816+0.0303338im    -0.0174133-0.00791793im  0.00415089-0.098786im     -0.399808+0.141795im      0.102695-0.10741im        0.223758+0.210593im      0.141318-0.136867im       0.0189053-0.09975im      -0.0300471-0.0635771im     0.0135024+0.0873404im     0.131661+0.046493im      0.0116697-0.0747859im     0.012602+0.0985282im    -0.122831+0.104159im      0.0793389+0.103026im     -0.0624424+0.104812im       0.175058+0.296332im    -0.134408+0.155867im    -0.0131381+0.0744495im      -0.191348+0.0048684im     0.0301357+0.0709275im    -0.0163141-0.0864422im    -0.216306+0.142334im      0.104495+0.151635im
   -0.115719-0.129849im   -0.00427456-0.0791393im     -0.0395439-0.0858285im     0.0568236-0.146958im    -0.185924-0.0779052im  -0.0819008-0.0190749im   -0.0687105+0.079145im       0.199917+0.0137537im     0.0221475-0.15891im       -0.219551+0.115185im    -0.0958872-0.0268977im    -0.107028+0.135888im     -0.267019+0.0789im        -0.163642+0.0342333im    -0.284968-0.0655197im      0.0298313-0.111217im       0.105601+0.00472982im   -0.0498711+0.138178im     -0.234534-0.0337654im       0.22606-0.0485819im   -0.0405538-0.0320431im   -0.0620865-0.0491951im     0.0836844-0.0459786im      0.386993-0.05589im       -0.122001+0.151772im    0.0545891+0.00988924im  -0.0388502+0.0427727im      -0.290746+0.0514769im      0.131193+0.0398487im   -0.00492359-0.0622581im     0.121408+0.0895062im    0.0636983+0.0723506im
    -0.12392+0.0187114im    0.0652326+0.209884im        0.161175-0.0531792im    -0.0305253-0.0540187im    0.225275+0.085563im   -0.0542468+0.142193im     0.0889157-0.185458im       0.264835+0.0535998im     0.0582714-0.181682im     -0.0797274+0.121894im      0.100972+0.218488im     -0.234687+0.0600819im    0.0631123-0.0508389im    -0.0444969-0.213746im     -0.011769-0.160234im      -0.0198505+0.0684767im     0.0848309+0.00650493im   -0.0227221+0.141909im     0.0181952+0.0852871im       0.10444+0.111397im     0.0686137+0.295082im     0.0465184-0.0160978im    -0.0113251-0.0598576im     -0.186827-0.198998im      -0.083252-0.183228im    0.0625092+0.00238336im   -0.178818+0.0623712im       -0.02185+0.0797482im     -0.201697+0.0102254im     0.0244829+0.180076im      0.155037-0.114033im    -0.0468408+0.126558im
    0.113337+0.173349im     -0.039006-0.165542im       0.0827349-0.0413498im     0.0837178+0.0405435im   0.0386808-0.084891im     -0.20487+0.131745im    -0.0351343-0.160812im        -0.1346-0.035347im      -0.092074+0.221343im     -0.0993038+0.103491im     0.0710475+0.0423211im    0.0161129-0.241767im       -0.1126-0.195769im    -0.00465114+0.0262478im    -0.037642+0.0654061im      0.0363969-0.0447255im     -0.234205+0.197471im     -0.0467533-0.0321388im    -0.237741-0.0569678im    -0.0489959-0.158312im     -0.125344+0.301115im     0.0610341+0.0381412im     -0.135779+0.0213911im    0.00897035+0.00398078im    0.0128301+0.217188im   -0.0709721-0.0496234im     0.117392+0.258506im     -0.00565007+0.0103954im     -0.128996+0.0508264im      0.107016+0.150056im      0.275057+0.103385im     0.0448348-0.0133467im
  -0.0867357+0.104525im     0.0562457-0.118811im       -0.050859-0.0835337im       0.17156+0.0544204im    0.090899+0.0549997im   -0.153225-0.0286582im    -0.238179+0.00957005im     0.103924-0.0564116im     0.0615699-0.00950901im     0.180939+0.0805112im     0.132101+0.117587im    -0.0268971-0.122726im     0.0990343+0.0607072im      0.107153+0.0423109im     -0.20686+0.149036im       -0.464813+0.000958171im   0.0228013-0.061696im       0.113627-0.0639124im    -0.132081-0.0435168im      0.223222+0.210695im     -0.066606+0.184462im     0.0432409+0.177792im      0.0593281+0.0403903im     0.0535559+0.118929im      0.0700646-0.0677706im     0.21811+0.147098im     0.0664914-0.0824685im      0.0767833-0.182684im     -0.0423314+0.0392771im    -0.0555764-0.187004im     -0.109331+0.0519247im  -0.00462072-0.0606839im
  0.00469947-0.121736im     0.0342233-0.14206im        -0.015164+0.0252258im     -0.058873+0.153733im    -0.022205-0.0258898im  -0.0254017+0.00170043im   0.0019509-0.116776im     -0.0802232+0.127116im        0.19089+0.047139im      0.0709199-0.0525367im    -0.152752-0.05533im     -0.0306216+0.356078im     0.0349036-0.0460595im     -0.276135+0.146998im       0.10224+0.152035im      -0.0843394+0.068448im      -0.329021+0.0543657im      0.095621-0.189057im    -0.0128419+0.264987im      0.0969706+0.200182im    -0.0863777+0.111816im    -0.0315473-0.0165704im     -0.058855+0.0895905im    -0.0244016+0.0845638im    -0.0482442-0.0455262im   0.0817044+0.0944352im   -0.0787523-0.00930882im      -0.15208+0.250482im    -0.00603483-0.168002im       0.223384-0.0158294im   0.00049168+0.0674598im    -0.128739+0.150133im
   0.0495023+0.0738871im   -0.0344863+0.0420874im      0.0949804+0.103051im     -0.0152716-0.0044999im    0.227381+0.151076im    0.0825742+0.245691im      0.064693-0.134272im     -0.0682881+0.0680592im      0.114081-0.0561841im    -0.0389009+0.0786607im    -0.214603+0.0814742im    0.0280944+0.166526im     0.0566935-0.0907689im     -0.201035+0.0742615im    -0.134486+0.055574im       0.0133651+0.163725im      -0.168217-0.0966502im      -0.30351+0.235522im    -0.0764496-0.12343im       0.0282804-0.0219285im   -0.0233612-0.0551328im    -0.181387-0.0226311im      -0.10272-0.000242884im  -0.0751809-0.0355293im     0.0295362+0.0148826im   0.0288924-0.16381im       0.203442-0.161416im      -0.0136133-0.238903im      0.0132884+0.00326741im    0.0195001-0.304983im    -0.0154016+0.0247392im     0.146601-0.232268im
   -0.169588+0.0156626im     0.297805-0.213365im    -0.000203445+0.0323512im    -0.0907821-0.290516im   -0.0626459-0.125026im     0.073321-0.0956702im     0.112487-0.144404im      0.0998496+0.0169643im      0.126949-0.189382im       0.102287+0.0493947im    -0.213825-0.0667935im   -0.0591301-0.0422905im    0.0781334-0.00376472im    0.0925814+0.0599072im     0.197678+0.118607im     -0.00874136+0.062784im     0.00167957+0.0119786im    -0.0108948+0.218797im     -0.158417+0.0453596im     -0.144884+0.118345im      0.137796-0.0383549im     0.147218-0.0724918im     0.0297827-0.0597233im     0.0700231+0.205419im      0.0755566-0.022099im    0.0653168-0.0174009im     0.236639+0.235282im        0.140657-0.0228911im      -0.10602-0.20057im        -0.12643+0.12987im      0.0213875+0.0999539im     0.151734-0.00198637im
  -0.0155178-0.0120909im    0.0975551-0.0639529im        0.23959+0.0295957im      0.152172-0.160858im    -0.104979+0.0852766im   0.0155736-0.0388647im    -0.139261-0.0327013im     0.0706306-0.294964im       0.211441+0.159649im       0.104823+0.185111im    -0.0880303+0.11992im      -0.126712-0.00666612im   -0.129537-0.114986im       0.030608-0.0984249im    -0.008123+0.151102im      -0.0190879+0.119647im       0.026596+0.181994im      0.0727546+0.065319im       0.27556-0.0995694im   -0.00442799-0.13232im      -0.090251-0.147798im    -0.0757746-9.89393e-5im   0.00161848-0.299484im     -0.0750881-0.01198im      -0.0331344+0.0361152im   -0.112657-0.0149901im    0.0457448-0.202358im       0.0869505-0.0114798im     0.0871273-0.0794506im      0.146221-0.0187887im    0.0240814+0.179609im      -0.20462+0.244832im
    0.069032+0.0872763im   -0.0148764-0.0319004im     -0.0103535+0.0377712im      0.109466-0.156259im    -0.129178-0.282225im     -0.15165-0.0246105im     0.109681-0.0210279im     0.0797394-0.231823im      -0.123344-0.16109im      -0.0673753+0.227496im    -0.0243467-0.122878im     0.0531857-0.0561316im    0.0301542-0.144503im       0.043797+0.0510333im     0.151742+0.0990157im       0.143406-0.0644817im     0.0301421-0.0253591im     -0.145137-0.0299762im   -0.0227056-0.0193441im    -0.0159669+0.0421527im    -0.193836+0.262972im     -0.135422-0.105843im     -0.0931221+0.179861im     -0.0133494-0.040518im     0.00723704-0.379659im     0.013798+0.0977611im   -0.0302594-0.266106im        0.048578+0.0754726im      0.207628+0.0225911im       0.12549-0.0379258im    -0.164692-0.0783767im     0.139941-0.00300855im
 -0.00913763-0.0766037im    0.0503477-0.0913079im     0.00256489+0.00970316im     0.079918-0.0158139im   0.0505007+0.17875im     0.0502107-0.207801im     0.0739056+0.0942738im     0.0385046+0.0140533im    -0.0451118+0.106549im       0.286347-0.0663781im    0.0148521-0.114902im     0.0351765-0.0505626im     0.164942-0.130183im      0.0774372-0.0816351im    -0.167519+0.0052146im       0.236195-0.0361141im     0.0476062+0.0929491im   -0.00544949+0.0232319im    -0.110958+0.0711188im     0.0597349-0.0292222im    0.0839546+0.0200552im    -0.481394+0.131162im      0.0384521-0.0924832im     0.0731758+0.0705914im      0.211676-0.294688im    0.0952328-0.134514im    -0.0699551+0.228933im       -0.112305+0.00141963im   -0.0206791+0.0226815im      0.167355-0.0740317im     0.209349-0.0631153im   -0.0140578-0.00204693im
   0.0573399-0.0744263im     0.215667+0.0548206im       0.109163+0.00546925im      0.10237-0.124241im    0.0477373+0.0667695im  0.00531664+0.103955im    -0.0882474-0.0924307im    -0.0746066-0.113903im       0.115112+0.109331im      0.0709146-0.105076im    -0.0163293-0.0239894im     0.167559-0.106171im     0.0113758+0.116664im       0.190342+0.0411156im   -0.0134799-0.145958im       0.0458807-0.235209im      -0.103895-0.0409635im     -0.114638+0.0400906im     0.070096+0.207102im      0.0906934-0.00836314im    0.123182-0.0539442im    0.0123874-0.0972994im     -0.515717-0.0500077im      0.100867-0.115252im      0.0173328+0.0174659im    0.251182+0.0956916im    0.0234318-0.0644313im      -0.249315+0.0419664im    -0.0831533+0.138888im     -0.0922432+0.083214im     -0.191256+0.0753404im    0.0531215+0.0904122im
   -0.100821-0.0246331im    -0.140499+0.0245485im      0.0641766-0.206463im       0.017274+0.0301127im   -0.117433+0.136859im   -0.0414408-0.039572im     0.0240617-0.130355im       0.188258+0.0534486im    -0.0134727+0.0611803im   -0.00916433-0.201168im    -0.0974496-0.0445866im    0.0346573-0.132611im     0.0718327+0.0755748im    -0.0958802-0.196288im     0.0499771-0.0599934im     -0.0237921-0.0489952im    -0.0765393+0.042372im        0.20067+0.0737035im    -0.029361-0.0779408im      0.123556-0.4282im      -0.0354085+0.16424im       0.090192-0.278579im    -0.00867739-0.0535513im     -0.199016+0.298207im      0.0632313-0.0514134im    0.074419+0.0339736im      0.12267-0.0881348im      -0.168588+0.0985519im     0.0673548-0.197045im     -0.0516107-0.156173im    -0.0871232-0.135054im     0.0792605-0.0753852im
   0.0476199+0.0114345im     -0.12528+0.254251im       -0.130497+0.0690574im    -0.0479441+0.108757im    0.0969779+0.101508im   -0.0682686-0.0594582im     0.136494+0.0670261im    -0.0279327+0.0801678im     0.0494949-0.0399907im     0.0470597+0.166614im      0.207447-0.161168im     0.0925263+0.0107798im     0.115536+0.0660184im     -0.084743-0.12587im      0.0604419+0.12364im         0.071516+0.0595695im     0.0775114+0.241627im       0.154455+0.402272im      0.117542+0.10699im       0.0133541-0.0917407im    -0.129227+0.00778271im   0.0316569+0.0858588im     -0.102952+0.06907im        0.262604+0.109198im      -0.225965+0.0572348im    0.159898+0.155621im      0.120733+0.0238467im      0.0819638-0.0855968im    -0.0201224-0.0151585im      0.218154+0.0926995im    -0.101351+0.185773im     0.0520238-0.0109928im
   0.0347466-0.137837im      0.242949+0.0918521im      -0.146455+0.025891im     -0.0458927+0.235561im    0.0148311-0.0426953im  -0.0658276+0.275286im    -0.0104853+0.23739im       0.0120795-0.0189444im    0.00265329-0.184752im       0.172335-0.218371im    -0.0130897+0.168465im   -0.00538498-0.177496im    -0.0768727-0.0464573im     0.0881698-0.0437741im    -0.145517-0.000764267im     0.072156-0.00578203im   -0.0337732-0.184172im     -0.0663883+0.0822735im    0.0866974+0.125563im       0.022551+0.0264841im   -0.0328028+0.223716im    -0.0596918+0.034281im       0.101313-0.109794im      0.0577666+0.156096im       0.044513+0.076828im    -0.314812-0.0580809im     0.153801-0.163944im      -0.0249165+0.130814im      0.0347832-0.144799im       0.136198+0.112675im      -0.03084+0.118523im      0.209815+0.100096im
    0.115197+0.0353634im    -0.139121+0.0590282im      -0.025985+0.226264im      0.0828889-0.0234923im    0.107885-0.0140332im   0.0581181+0.0260359im     -0.17273+0.367023im      -0.100023-0.147023im      0.0261592-0.197586im     -0.0710089-0.0673872im    -0.117633-0.0529374im    0.0209285-0.0660779im   -0.0860067+0.0465174im     -0.209191+0.136772im      0.134461-0.118309im       -0.139146-0.257274im      -0.186777+0.00501089im     0.180161+0.215701im    -0.0207296-0.225987im       0.102565+0.0393572im    0.0741616+0.0967158im   -0.0137646-0.114501im    -0.00518406-0.0941449im    -0.0624073-0.105196im       0.101505-0.215369im    0.0292325-0.0703864im     0.110208+0.216903im       0.0525119-0.0466132im    -0.0485538-0.0932804im     0.0454978+0.0789462im   -0.0299671-0.0191273im    -0.212455+0.0950535im
  -0.0198129+0.0273153im     -0.11282-0.219995im       -0.118205-0.0345724im     0.0937784-0.051023im    0.0110204+0.0346705im    0.125875-0.00863868im     0.17115+0.00871143im   -0.0325813-0.0771414im      0.174192-0.0754442im      0.210106+0.156383im     0.0840046-0.183943im      0.203125+0.126089im      0.235746-0.0146919im      0.138702-0.0823174im    -0.159431-0.168816im       -0.103385-0.0796934im    -0.0405904+0.00159814im    -0.110244+0.00421542im   0.0511175-0.230242im      -0.130073+0.0327228im    0.0469945+0.162702im       0.12431-0.0941519im      0.078581+0.00473868im    0.0840774-0.0539898im     -0.244497+0.0329209im   -0.271662-0.0124713im     0.133251-0.104016im       -0.238189+0.164313im      -0.225723+0.00456814im  -0.00908797-0.0383923im    0.0294911-0.0437214im    -0.205491-0.028657im
  -0.0376293-0.0204715im    0.0434687+0.0408304im       -0.14991-0.0322648im   -0.00883361-0.18769im     -0.049997-0.0963482im   0.0200586+0.15694im     -0.0184516+0.112962im      -0.107473+0.139354im      -0.158662+0.0932866im    -0.0164668+0.016247im     -0.132669-0.0630706im    0.0374338+0.0959282im    0.0165289-0.136429im     -0.0650514+0.0325912im   0.00901319+0.0968169im      -0.163389-0.175845im       0.216864-0.151685im     -0.0665162+0.099975im      0.174755+0.224715im      0.0423724-0.137093im     -0.277542-0.00703926im  -0.0323005-0.152265im     0.00437997-0.0800509im      -0.13615+0.219897im     0.00792989-0.109945im   -0.0305849+0.122336im    -0.0471216+0.00538408im     0.0463408-0.0306059im     -0.336326+0.255219im      -0.106246-0.104053im      0.254288+0.146942im     -0.127826+0.000259829im
   -0.183443+0.0510834im    -0.129641+0.201362im        0.171911+0.105528im      0.0786595-0.124458im    -0.114102+0.0737043im  -0.0741225+0.12388im      0.0231168-0.0738059im     -0.134397-0.00181155im     0.175147-0.148702im      0.0682166+0.201716im     -0.113181+0.0614137im    0.0819441-0.094155im     0.0149346-0.0433984im    -0.0694778-0.0403461im    -0.108713+0.185238im       0.0798584-0.0513656im    -0.0805505-0.104785im       0.171342-0.224022im       0.16801+0.0101641im      0.185833-0.0558282im     0.157414-0.1084im       0.0134491-0.00734815im    0.0246247+0.278781im        0.14309+0.155415im       0.121571-0.0658934im   -0.303226+0.0939646im    -0.104368+0.152711im       -0.132042-0.190578im     -0.0887058+0.0213979im   -0.00812596+0.174248im    -0.0231917-0.0736214im    0.0756684-0.0752465im
   -0.207034+0.129517im     -0.168096-0.095403im       0.0846149+0.0771152im     -0.044728+0.0508504im  -0.0556231-0.340946im     0.175777+0.233444im       0.16825-0.0163457im   -0.00971573+0.0679115im     0.0433939+0.017732im       0.189064-0.144868im     0.0536905+0.0552004im   -0.0474174-0.0233462im    -0.205927-0.0605988im    0.00477489-0.0162337im    -0.218384-0.0375871im     -0.0375351+0.0881585im      0.222449+0.103856im      0.0114528-0.0377563im    0.0765276+0.0147342im    -0.0702138-0.00801042im   -0.222764+0.0578779im    -0.156296-0.109259im      -0.125202-0.0327704im     0.0523469-0.0924391im     0.0567447+0.0390576im     0.13589-0.0182962im   -0.0345887+0.226481im      -0.0180686-0.0677785im    -0.0678845-0.209915im    -0.00515374+0.0069662im    -0.353972-0.0511259im    -0.152031-0.0632472im
 -0.00601584-0.0774438im    0.0150896-0.116313im         0.38947+0.0459696im     0.0382999+0.0412064im  -0.0349703+0.130211im   -0.0898695+0.124208im     -0.103426+0.0391436im     0.0595374-0.107582im      -0.157827+0.0447415im    -0.0486042-0.0751628im    0.0782286-0.0165321im      0.20249-0.041219im     0.0519145+0.00908093im    -0.102595-0.0049921im    0.0356722-0.137621im       -0.126864+0.296082im       0.119387-0.184007im     -0.0179396+0.221687im     -0.125577+0.141952im      -0.250601+0.00158811im  -0.0116216-0.0635766im     0.179087-0.0322233im   -0.00823805+0.185073im       0.179442+0.034288im       0.101863-0.15004im     -0.188428+0.0599636im   -0.0869682+0.184178im      -0.0232154+0.102153im      0.0335156+0.0516236im      0.144511-0.2248im      -0.0701119+0.061814im      -0.10696+0.108544im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.22997586864871028 + 0.026061255519261417im
    0.2070122756846077 - 0.12683715514565633im
   0.10480625698698466 + 0.02418065341957148im
   0.00290244208352695 + 0.07717934973499216im
   0.20834728668842115 + 0.04435128640154107im
    0.2957348020308879 - 0.061972821991261286im
    0.1951831116991409 - 0.14202202401413533im
   0.22687743553191278 - 0.023830717370097253im
  -0.07094205281358432 + 0.12192499415686034im
    0.1838427504690677 - 0.0051258351635337365im
   0.12551799545714648 - 0.001779064402347626im
   0.08497690447848968 - 0.1002268252366581im
  -0.07600679995550866 - 0.22788039431208343im
   -0.2828622268673461 + 0.05507781345088357im
 -0.005962294395218684 - 0.2776535488490331im
  -0.09547087281492468 - 0.05018515461247781im
   -0.0699541837134391 + 0.012340764848247983im
  -0.11486940591004971 + 0.1400079688547851im
   0.33377536509349304 + 0.0im
 -0.061535364251735225 + 0.02129281157852168im
   0.08648171301113187 - 0.030532371267965593im
  -0.03871246266589807 - 0.06028174875663648im
  -0.01401843881499207 - 0.06277611405977408im
 -0.051115070471031226 - 0.0789792191720131im
 -0.016251395966623457 + 0.015529320484406684im
  -0.15109643582346832 + 0.1385407739851852im
  -0.05511771954164204 - 0.005518516047204316im
   0.12054563956361182 + 0.023119017359701805im
  -0.09632015623208197 + 0.033691609190380924im
  -0.13377919433070654 + 0.08620545068811333im
  -0.14465577557949638 + 0.062254135201325125im
   0.06981467415956484 - 0.02478370184369381im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Monday 6 June 2022 17:34">Monday 6 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
