<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
    0.329339+0.0361501im    -0.0972253-0.106585im     -0.014164-0.136448im      0.119955-0.244618im     -0.0577283+0.00631141im     0.138975-0.0885921im     0.00497481+0.0335558im     -0.191055+0.0703337im      -0.0267559+0.141712im    -0.0788054+0.0456149im      0.141013+0.104482im      -0.124856+0.0215492im    -0.0503035+0.0899578im    0.0471881+0.127513im      -0.0787484-0.132859im     0.100831+0.0946641im     0.123064+0.0373719im     -0.184384-0.240639im     0.0929806+0.171081im       0.0187863-0.135122im      -0.208949-0.0224981im   -0.0815636-0.137492im      -0.100713-0.146746im     0.0817323+0.194104im       0.0691459+0.137398im   -0.0905496+0.323661im     -0.152331+0.151293im      0.000870532-0.15759im        0.0918097+0.0592557im     0.0622129-0.0516596im     -0.129379-0.00473225im  -0.0410986-0.000678178im
   -0.007618-0.00831517im      0.19438-0.139523im     0.0310078+0.0839254im   -0.0476732+0.0941258im     0.0916105+0.122783im       0.146866+0.0941088im      -0.190269+0.00767569im  -0.00255942+0.23436im         0.0628751+0.0260378im    -0.048554-0.0494299im     0.0849849+0.0136776im     0.0712935+0.0356328im      0.141614+0.123804im    -0.0322489-0.0786301im       0.160567-0.111429im      0.20278-0.0381237im    -0.177325-0.0325428im     -0.257314+0.0204108im    -0.239994-0.118469im       -0.226801-0.128978im      0.0690536+0.111287im    -0.0114013-0.0426598im    -0.0457931+0.0247326im    0.0658928-0.056062im       -0.111361+0.147268im    -0.182812+0.00724369im  -0.0860079-0.251263im        -0.168738-0.0857043im      -0.160595+0.179682im      0.0986534-0.13305im       0.0337604-0.0515038im    -0.083154+0.305888im
  -0.0423234-0.155346im    0.000661757+0.0211303im   -0.0629393-0.161319im    -0.0545682-0.0167777im   -0.00198974-0.0194766im      -0.17088+0.167155im       0.0371798-0.0101162im     -0.135297+0.0847255im    -0.000303164+0.167961im     -0.106563-0.120262im      -0.119526+0.0479008im     -0.268676+0.134084im     -0.0785511+0.153667im      -0.20968-0.0996203im      -0.093593-0.0502816im   -0.209272-0.15786im      0.0341628-0.106746im      -0.116846+0.157772im     0.0931807+0.0460731im     -0.0804038-0.0304616im     -0.098519-0.368559im       -0.1827+0.199795im      0.0530573+0.162609im    -0.0123238-0.184064im       0.0050271+0.0447808im   -0.163696+0.00802958im   -0.206388-0.152361im       -0.0185409+0.0679168im        0.12177-0.0870507im      0.172023+0.118617im      0.0373523-0.0918532im   -0.0662379-0.00791357im
  -0.0580826+0.00404896im    0.0223273-0.0216901im    -0.155993+0.173132im    -0.0396541+0.265325im      -0.310904-0.163828im      0.0302544-0.0104271im      -0.214181+0.00514817im    -0.183461-0.0277107im       0.0578278-0.065472im     -0.170321+0.0485598im   -0.00928365-0.216093im      -0.085287+0.242076im       0.023789+0.0521866im    0.0515504-0.127662im     -0.00817745+0.210326im     0.176549-0.0236322im     0.112981-0.00364297im    0.0334537-0.228901im      0.127571-0.0624509im      0.0449151+0.202577im       0.116641+0.127448im    -0.0491398-0.162941im       0.100567+0.0798231im    0.0436688-0.00692471im     0.0159346+0.154784im     0.020891-0.0194939im    -0.267186+0.0200795im      -0.0406797+0.0276829im        0.11048+0.080807im      0.0578723+0.226475im     -0.0755639-0.0679344im      0.15536-0.0269627im
  -0.0810748-0.0282517im     0.0556145-0.188907im    -0.0948789+0.189498im    -0.0240018+0.0937213im    -0.0808189-0.0747646im    -0.0347174+0.0357746im      0.0245961-0.115888im     -0.0190032-0.10872im           -0.2487+0.0536911im    -0.144259+0.0511423im      0.192618+0.0511721im   0.000315961-0.135449im       0.110757+0.0209257im     0.103337+0.020199im       0.0230164-0.0169928im   -0.213051-0.112188im     -0.350064+0.173673im     -0.0793816+0.054376im      0.189832-0.0321148im      0.0844489-0.0754766im     -0.143437-0.0414105im    -0.266399-0.115297im       -0.13552-0.00658904im   -0.106143-0.0962801im       0.153871-0.102472im   -0.0190426-0.147148im    -0.0274205+0.183189im        -0.103733+0.000465929im    -0.143332+0.244898im      -0.121235+0.06848im       -0.148819-0.00615095im   -0.210397-0.070451im
    0.136263-0.013791im      -0.260635-0.0106106im    -0.270916-0.0891284im     0.051384-0.00607825im    -0.175303-0.0726618im     0.0951056+0.135368im       0.0239448+0.13102im        0.124051+0.111557im       -0.0879853-0.138009im      0.141429+0.0803328im     -0.169095-0.106454im     -0.0514482+0.0937901im    -0.0513077-0.144198im      0.146631+0.0578268im       0.102908-0.0112252im   -0.210442+0.0820735im    -0.293074-0.00806206im    0.0189024-0.146627im    -0.0330003-0.000865462im    -0.120041-0.00167906im   0.00730891-0.0123663im     0.056589+0.127613im     -0.0530493-0.165563im      0.312541-0.102503im        0.258278-0.029801im    -0.147088-0.0532881im    0.0344663-0.141247im         0.137665-0.0854334im     0.00237231+0.0195191im    -0.0599198+0.172138im      0.0999219+0.0116595im    0.0286183+0.200441im
    0.227215-0.13133im         0.18282-0.223649im     0.0963703+0.168988im     -0.116709+0.0522723im      0.104312+0.265932im     -0.0214021+0.00728922im      0.276173+0.104745im      -0.199851-0.0476216im        0.069026-0.154511im     0.0628533-0.0456866im     0.0219457+0.0646931im     0.0865569+0.165672im       0.270119-0.0908889im    0.0786614+0.101261im        0.162177-0.0737823im   -0.167452-0.00139938im    0.110944+0.0024725im      0.180601-0.0593907im     0.132978+0.146362im     -0.00475315-0.0761921im     -0.055241+0.090585im      0.103488+0.0441576im    -0.0738983+0.174478im    -0.0255151+0.0289802im       0.104578+0.0544006im   0.0231406+0.0585712im   -0.0736263-0.246943im       -0.0563797+0.0874733im      0.0131203+0.0179101im     0.0121229+0.255527im      0.0485255+0.153466im     0.0143507-0.091341im
  -0.0678375-0.106919im       0.339816-0.258298im    -0.0902253-0.0508318im   -0.0370884-0.0225859im     -0.141365+0.0291222im     -0.100533-0.284189im       0.0602111-0.00527033im     0.102706-0.162873im         0.287404+0.0566358im   -0.0958604+0.102067im      -0.213466+0.028826im      0.0319152-0.101385im     -0.0339421-0.0287259im    -0.111714-0.0655525im      -0.164755-0.149576im    -0.072389+0.0337222im   -0.0183837+0.183667im      -0.124016-0.0453094im    0.0397177+0.0497001im     -0.0196481+0.097671im     -0.0378542+0.101284im      0.129522-0.0394503im    -0.0246831-0.195148im       0.23415+0.045366im      -0.0385727+0.026597im   -0.0382887-0.11276im      0.0519829+0.0910971im        0.106843+0.214555im       0.0102466-0.0727743im      0.195724+0.0816439im      0.074148-0.106801im     -0.200361+0.125071im
   0.0103248-0.0280089im    -0.0859104+0.0772399im    -0.285557-0.163545im     0.0326066-0.019882im     -0.0873873+0.21529im         0.04841-0.0680694im      0.0520618-0.0750153im     -0.258219-0.128623im          0.16102+0.047429im    0.00456511+0.019729im       0.187301+0.0983556im     -0.103283-0.229515im      0.0982222-0.0709758im    -0.151836+0.0361722im      0.0848142-0.173131im   0.00941277-0.0548544im    -0.206907-0.0337129im      0.102428-0.0537464im    -0.138715-0.036477im        0.187745-0.0760758im      0.110132+0.254111im     -0.157267+0.0555996im      0.379718+0.0542709im     0.011771-0.129235im       0.0504518-0.10741im     0.0999073+0.109867im     0.0411301-0.0531153im      -0.0898585+0.0280587im      0.0572891-0.0109454im     0.0314131+0.00267258im    0.0574473-0.216226im      0.126713-0.00667761im
   0.0548728+0.0423257im     0.0220728-0.0214944im   -0.0962968-0.029074im    -0.0245074+0.0145748im      -0.10211+0.0333288im     0.0941457+0.134115im       0.0648203+0.0782973im    -0.0834681-0.123854im        -0.339611-0.136599im      0.037058-0.110517im       0.132779+0.0126892im       0.10719+0.170404im      -0.228068-0.179404im     -0.053815-0.0933726im      -0.173254+0.0880722im    0.328418-0.19768im     -0.0933726+0.142805im       0.147528+0.260856im     0.0595243+0.0652302im      0.0476965+0.0104968im     0.0380795+0.0704698im    0.0315518+0.132737im      0.0288843-0.0830354im     0.020958+0.116855im       0.0634037+0.0961497im   0.0163573+0.182164im     0.0916004-0.0760219im      -0.0730964+0.13923im        0.0343689-0.0419525im      0.217986-0.0378348im     0.0458613-0.011278im     -0.325404+0.0654394im
     0.23062+0.0191208im    -0.0760462+0.28248im      0.0213333+0.043295im    -0.0958333-0.0658213im     0.0702804+0.115691im      0.0908388+0.00118471im    -0.0678975-0.00505976im      0.15794-0.12772im         0.0675482-0.153032im    -0.0785735+0.225384im      0.0102058-0.125904im       0.139904-0.0241581im    -0.0531756-0.140827im      -0.26812+0.169789im       -0.075943+0.0233989im   0.0153721+0.135757im    -0.0626091+0.0102703im     0.0608981+0.00251216im     0.16297-0.120144im       0.0362851-0.0671149im     -0.114405-0.0588395im    -0.317384-0.236477im     -0.0654557+0.0540996im     0.134959+0.000350886im    -0.152968-0.0363322im  -0.0974509-0.137681im     -0.221916-0.236803im       -0.0265041+0.255604im       0.0133474-0.0546633im     0.0336828-0.113821im      -0.053529+0.0651056im   -0.0264254+0.0188926im
   -0.313752+0.0266403im      0.118737+0.135734im      0.182756-0.00927587im  -0.0557362-0.166247im      -0.191385-0.0952849im   -0.00856025-0.0679068im      -0.102836+0.0800925im     -0.163618-0.0716612im       -0.141335+0.0246844im   -0.0283578+0.0924995im      0.207539-0.0666393im      0.167557+0.137889im       0.170186-0.110002im     0.0408959+0.0854084im       -0.18275-0.313663im   -0.0950245-0.052146im     0.0270904-0.00486587im   -0.0759028-0.0920035im     0.181339-0.210249im       0.0277678-0.0448718im     0.0619749-0.079362im     0.0780569-0.0104017im     -0.064305-0.0520404im   -0.0292832-0.0758857im       0.115147+0.124365im    -0.178532+0.1297im        0.129061-0.175941im        0.0370631+0.00685273im   -0.00222407-0.201825im      -0.178599-0.0684042im      0.158526-0.113536im      0.139535+0.0280206im
   0.0145759+0.02177im       -0.013718+0.0497866im     0.111997-0.0756278im    -0.176745-0.272877im        0.10809-0.0437829im     0.0751047+0.222603im       0.0528799-0.20967im      -0.0486546-0.02505im          -0.14794-0.00690823im   -0.166022+0.1457im        -0.343312-0.0586203im     0.0280487+0.0801922im      0.308822+0.0607143im    -0.220043-0.0142797im     -0.0924058+0.112685im    0.0992195-0.169696im    -0.0315428+0.0488138im    -0.0458319+0.035697im     0.0159618+0.0824494im    -0.00397749-0.147108im       0.180139+0.236325im     0.0730686-0.00769031im   -0.0145357-0.0838662im    0.0312183+0.00924797im     -0.051843-0.215896im    -0.102458+0.113001im    -0.0300958+0.111431im         0.191729-0.0267751im     -0.0319778+0.177255im     -0.0610452+0.178011im      0.0437605-0.0899234im    0.0607782-0.0703977im
  -0.0152493-0.151581im      -0.119368-0.0670071im    -0.113493-0.0144551im    -0.025303+0.0374382im   -0.00653329+0.439689im       0.122327-0.0215974im     -0.0487203-5.10111e-5im     0.220785-0.0462953im      -0.0307058-0.10802im      -0.123937-0.161685im      0.0471043-0.103119im     -0.0100397-0.0572366im      0.107039-0.00213993im   0.0361114+0.147414im       -0.130262+0.189894im   0.00327018-0.0522894im    0.0349186+0.00187034im   -0.0794177-0.182529im     0.0617569-0.0522914im      0.0180813+0.0887362im     0.0190286-0.153718im      0.027114+0.171879im     -0.0784524+0.144129im    -0.0833492+0.256351im       -0.101002+0.0763277im   -0.156922-0.0824896im    0.0799559+0.100797im      -0.00878689-0.103325im        0.119692+0.0745045im     -0.125715-0.0305472im      0.237832-0.362937im    -0.0710844-0.0779252im
   -0.126999-0.100044im       0.069754+0.0163001im   -0.0511967+0.181049im     -0.154336-0.0732063im    -0.0992348-0.0378404im    -0.0579407+0.000957713im     0.273814+0.105742im       0.127907+0.108371im       -0.0501068+0.159106im    -0.0148682+0.295374im       0.031677-0.142502im      -0.220293-0.17329im       -0.041685-0.149375im     -0.108699+0.0822108im      0.0671845+0.0256698im    0.112214+0.0700277im   -0.0651032-0.0407436im    -0.0274741+0.120273im     0.0549735+0.148612im        0.231544-0.0567035im      0.150399-0.00760146im   0.0957077-0.0513168im      0.074339+0.140054im     -0.160725+0.21732im        0.0633113+0.100309im   -0.0884961-0.0758771im    -0.163266-0.0305835im      0.00506391-0.346149im      -0.0187136-0.122741im      0.0748755-0.0174442im     0.0994627+0.128777im    -0.0108987+0.189885im
  -0.0455211-0.108228im       0.137367+0.203177im    -0.0178338-0.161297im      0.259801+0.0560699im     0.0341891+0.0461991im     -0.177744-0.0178909im      -0.088463+0.220822im      0.0888273-0.064765im       -0.0488861-0.0778433im   -0.0706787+0.13967im        0.190932-0.0610639im     -0.122102+0.0116175im      0.179184-0.044161im      0.242837-0.0161666im     -0.0744108+0.153311im    -0.145893-0.202329im      0.159397+0.0308372im      0.160371+0.0729634im   -0.0857772+0.0442623im      -0.120118-0.14827im       -0.104589+0.0663151im    0.0142399-0.201016im    -0.00169953-0.0943519im     0.056171-0.00795982im    -0.0363387-0.233202im   -0.0762287+0.00976162im  -0.0830438+0.00797977im   -0.000448727-0.154425im      -0.0787129+0.0991256im      0.365483-0.0522828im      0.184178-0.0210777im    0.0419029-0.0198762im
   0.0600104+0.064877im      -0.135256-0.00873192im    0.038357-0.0181371im   -0.0632043-0.0831709im     -0.118372+0.159758im       -0.15038-0.222683im      -0.0520933-0.090149im      0.0525065-0.132909im        -0.218698+0.0877732im    -0.246422-0.107879im     -0.0391467-0.00887651im    -0.108572+0.123777im      0.0486134-0.22074im     -0.0458477+0.149064im        0.133577+0.0800882im  -0.0811059+0.140589im      0.206318-0.132274im     -0.0596081+0.0322085im   -0.0753287+0.00845416im    -0.0551886+0.101087im      0.0756672-0.0242707im   -0.0186175+0.0564402im      0.149082-0.226804im    -0.0547834-0.205123im       -0.094651+0.0858927im   0.0822789+0.0907008im   -0.0856374+0.0856764im       -0.196204+0.059742im       -0.344998+0.0528691im    -0.0819644+0.0784262im      0.164788+0.163018im     -0.108384+0.187064im
   -0.144573+0.0361891im     -0.119284+0.146987im      0.258232+0.117828im     0.0469146+0.00811858im    -0.129173-0.0105497im       0.10676+0.204168im        0.278357+0.228769im     -0.0138091+0.0397091im        0.254804+0.0582566im    -0.163481-0.0490616im     0.0158228+0.0808215im     -0.209153+0.0195936im   -0.00548394-0.172367im     0.0974574+0.155143im       -0.088064-0.0702573im    0.123339-0.121014im    -0.0446322+0.000824489im   0.0602656-0.134449im     -0.106431-0.0425974im       0.047467-0.011757im    -0.00243339-0.038343im     0.0975338-0.0263029im     -0.110574+0.146018im      0.223634-0.261358im       -0.159999+0.0347808im    0.180361+0.0249911im   -0.0494923+0.0998381im         0.09028+0.0611554im     -0.0405773+0.152077im     -0.0734027-0.0314226im    -0.0307895-0.0716133im    -0.280739-0.0184868im
   -0.095522-0.014239im      -0.192063-0.0124808im    -0.119017+0.107606im      0.122236-0.162407im      -0.164529+0.00120216im    0.0745309+0.00193729im     0.0151337-0.220343im      -0.122294-0.277409im        0.0188179+0.128524im      0.116208+0.19243im       0.0805041-0.0408043im      0.276105+0.0216435im      0.113638+0.148794im      0.204214+0.0872667im      -0.145568-0.0112563im  0.00916718+0.0452301im     0.036087-0.149501im     -0.0131579+0.0935585im    -0.302859+0.24542im        -0.173997-0.085735im       0.159193-0.145372im     0.0585474+0.0991432im    -0.0177403+0.169299im      0.112753+0.0704031im     -0.0235141+0.0742082im  -0.0224944-0.20117im      -0.160221+0.000498329im    -0.0309653+0.0822468im     -0.0708333-0.0533765im      0.100306+0.0236226im    -0.0667534+0.0484748im    -0.102028-0.0922087im
 0.000481523-0.137832im      0.0027862-0.111194im      0.072405-0.0148329im   -0.0690326-0.111212im      -0.279849+0.00215166im    -0.139312+0.156995im       0.0190433-0.180366im       0.107681-0.110222im       -0.0252779-0.0871924im    -0.149314-0.0134222im     -0.140423-0.0545277im   -0.00755877-0.285601im        0.13236-0.0838488im     0.200395-0.0334094im       0.121597+0.125533im     0.146883-0.0290612im     -0.08253+0.041981im     -0.0138596-0.0753312im   -0.0212695-0.118582im      -0.0576418-0.217678im      -0.202817-0.165071im      0.135269+0.0896623im     0.0491643-0.175949im     -0.109529-0.067771im      -0.0568623+0.119591im     0.182027+0.0997691im   -0.0253066-0.192805im       -0.0488294+0.0842063im       0.287642-0.000845389im    0.109304-0.176862im      -0.117541+0.09883im       0.176231-0.0182692im
   -0.199851+0.0907488im   -0.00276935+0.0893552im    -0.117466-0.0906868im    0.0469676+0.200924im      0.0257486-0.00596656im    0.0342191+0.0676242im      -0.070904+0.0100034im      0.095656-0.242995im         0.235711+0.0957652im   -0.0195898-0.347814im      0.0360562-0.172847im       0.197386-0.00642094im   -0.0833925-0.215049im     -0.145814+0.0196022im      0.0852951+0.0288945im  -0.0481627-0.00684443im    0.115155-0.0558021im     -0.217071-0.00271617im    0.166956+0.2155im         0.0503146-0.382848im      0.0250701+0.159473im    -0.0090148+0.118072im      -0.123339-0.027254im     -0.016807-0.0636262im         0.1352+0.0610005im     -0.0451+0.0330619im   -0.0850189+0.0181279im        0.147265-0.117334im       0.0216952+0.105006im     0.00711791-0.0368346im    -0.0577724+0.15802im      0.0126542-0.0328089im
    -0.32996-0.196945im      0.0275036+0.00543325im    -0.11063-0.0843602im     0.158172-0.0195606im     -0.127257+0.0402526im     0.0235136-0.322783im      0.00350388-0.0316556im     -0.137857+0.233974im       -0.0532377-0.191471im    -0.0443475+0.14234im      -0.0699955+0.205922im      0.0430803+0.0853842im     -0.127928-0.106372im     -0.176106-0.145141im       0.0309857+0.0977334im   0.0894099+0.0865319im      0.01349-0.0118552im      0.111237+0.0354895im   -0.0288755+0.0637549im      0.0399708-0.224577im       -0.14638-0.14343im      0.0492578+0.0731984im    -0.0668794+0.0951128im     0.123347+0.131412im       -0.092373-0.0906618im  1.94465e-5+0.0547495im   -0.0366311-0.0874355im      -0.0209705+0.0517812im     -0.0629511+0.314136im      -0.263036-0.00401521im  -0.00532285+0.0950976im    0.0680688-0.0383085im
  -0.0787043-0.0160616im     -0.169477-0.0317338im    -0.173738-0.0665736im     0.108417+0.183125im       0.184244-0.0311511im    -0.0258294+0.0177033im       0.131614+0.054975im     0.00237144-0.000776082im     0.0732421+0.105738im    -0.0574503+0.273377im      -0.154942-0.105814im       0.127916-0.0613107im      0.092838+0.0243581im    -0.112398-0.0319027im     -0.0525616-0.0258326im    0.282002-0.0750381im    0.0678245+0.206207im       0.095468-0.302734im     0.0910706+0.0925011im      -0.228901+0.00592339im    -0.124983-0.127856im     -0.118906+0.0080275im     0.0377573+0.0025096im    -0.194721-0.191209im       0.0340782+0.131681im   -0.0151893+0.0808824im     0.265063-0.0799497im       -0.112751-0.0931661im      -0.248059-0.107295im      0.0171203+0.0552004im     0.0678309+0.0850956im   -0.0741199-0.100132im
    0.130726+0.113172im       0.103158-0.0526924im   -0.0900284+0.101069im     0.0576284+0.056239im      0.0464789+0.0186617im     -0.059577+0.0705688im      -0.285354-0.0278968im       0.10031-0.0283332im       -0.127015+0.0391405im   -0.0403148+0.116135im      -0.173909-0.00505262im   -0.0644959+0.12687im      -0.0134427+0.040954im       0.11428-0.0177622im      -0.134775-0.0838067im   -0.145295+0.0797674im   -0.0817758+0.141555im      -0.172368-0.0574411im    0.0296305+0.155404im        0.202546-0.0870804im     0.0243219-0.0441251im    0.0440412-0.0231821im      0.220995+0.369214im     0.0998374-0.0231194im     -0.0235598+0.0531568im    0.300999+0.183775im     0.0863337-0.112503im         0.170525+0.0285926im     -0.0609353+0.0936149im    -0.0150146-0.25857im        0.257273+0.105913im    -0.0352279-0.0809934im
   -0.132732+0.0298533im      0.195485+0.0537573im    0.0144157-0.206341im     0.0596498+0.12859im       0.0213396+0.194637im        0.17012+0.342005im      -0.0396234+0.038112im      0.0643429+0.0416951im       -0.164085-0.0627116im   -0.0175819+0.177635im      0.0546547+0.0622155im    -0.0188309-0.274509im      0.0320493+0.158165im     0.0506108+0.000394084im    -0.122477-0.100601im   0.00228646+0.1583im        0.237424-0.0455967im     -0.040757-0.0299083im     0.245419+0.119378im        0.135793+0.142111im       0.117941-0.00387932im   0.0492484+0.219795im      0.0158452-0.105629im      0.242415-0.0709453im    -0.00569162-0.0313359im   0.0881508-0.062637im    -0.0467345+0.00430407im      -0.254656+0.034269im        -0.03191+0.0496154im    -0.0411615+0.0839186im     -0.160386+0.123597im     0.0642845+0.0894935im
    0.160545+0.0172172im    -0.0086855+0.265566im     -0.152472-0.0894996im     0.109057-0.0110542im    -0.0324276+0.0277959im     -0.181625+0.0332953im      0.0703419-0.0632776im     0.0640425+0.0152865im      -0.0450365-0.0927868im     0.144086-0.0406834im    -0.0111376+0.0124832im    -0.0405245-0.0589117im      0.225058+0.00780388im   -0.125776-0.240412im       0.0672422-0.158529im   -0.0568282+0.100519im     0.0760361+0.183255im       0.116405+0.0694319im    0.0856649-0.272904im      -0.0817037-0.163552im       0.164573-0.0876162im     0.156806-0.0399621im     -0.108277+0.136501im    -0.0144541+0.0902831im      0.0749816+0.394518im     0.131894+0.00699614im   -0.112482+0.237303im        0.0688665+0.0415605im      -0.157446+0.077331im      0.0131773+0.0301918im     -0.125088-0.140031im    -0.0573949+0.0888673im
  -0.0255469-0.0187684im    -0.0389521-0.116402im     -0.238697+0.148722im    -0.0748207-0.275686im      0.0465836-0.0326831im     0.0959055+0.237963im      -0.0750024+0.135202im      0.0651746+0.0453622im        0.123639-0.0771069im   -0.0884958-0.0750861im     0.0286134+0.136428im       0.160412-0.0863051im     -0.159303-0.13894im       0.199966-0.148251im       0.0072558-0.0862657im  -0.0608256-0.237153im      0.148251+0.0486191im    -0.0178565-0.00565391im   0.0014739-0.0680022im       0.088991-0.129609im     -0.0527867-0.0837195im    -0.116657-0.0641159im        0.1285+0.0693694im   -0.0243182+0.104105im       -0.273144+0.0161735im  -0.0612983+0.0439264im    0.0162905+0.185811im        0.0256959+0.103452im       -0.213929-0.138109im      -0.023688+0.255569im      0.0449963+0.0941852im     0.226009+0.169874im
  -0.0690287+0.124429im       0.118708+0.026895im     0.0367699+0.0262326im     0.201844+0.00684204im     0.088632-0.05421im       0.0825052+0.0665684im       0.129589-0.175007im      -0.196985+0.0200982im       0.0102537-0.0252385im   -0.0299812-0.0795933im      0.152106-0.0819697im     0.0129524+0.00692265im     0.177417-0.0949467im    -0.106077+0.0562216im       0.147976+0.158313im    0.0744016+0.102385im    -0.0912218+0.210461im      -0.165165+0.147536im    -0.0475835+0.0568357im      0.0194844+0.157237im      -0.144123-0.196344im     -0.207593+0.0534447im     -0.160808-0.0879643im     0.235789+0.0867528im     -0.0863875+0.0709612im    0.304526-0.0473074im    0.0110499+0.0180396im        0.130735-0.104804im     -0.00533943-0.158519im      0.0683531+0.143949im        0.28869-0.043684im      0.215958+0.0695241im
    0.205006-0.191734im      0.0196223+0.0592633im    0.0755846+0.165402im      0.309283+0.229824im     -0.0898925-0.0092043im    -0.0734312+0.1101im       -0.00847358-0.140824im     -0.0813641+0.122191im        -0.106977+0.106168im     0.0651991-0.0134081im    -0.0816782-0.00398274im    0.0345909-0.108578im     -0.0612981-0.152768im     -0.142331+0.0539336im      -0.305069+0.0825855im   -0.156468-0.0536884im    -0.117857-0.149017im     -0.0367571+0.0645391im   -0.0447478+0.118359im     -0.00314059-0.0989915im     -0.130853+0.245453im      0.150088-0.118046im      -0.057531-0.00616633im  0.00702428-0.0893904im      -0.228528+0.219789im    -0.108504+0.013735im      0.122059+0.0911053im       -0.199034+0.00944111im     0.0436533-0.152913im      -0.143401+0.0906895im     0.0286359-0.0379418im     0.138915+0.0248673im
   -0.113968-0.0896396im    -0.0744372-0.0627489im    0.0413477-0.0950472im     0.111383-0.00835996im    -0.102747+0.178425im      0.0662896-0.0827453im     0.00202385+0.121883im      -0.040977-0.10467im          -0.15905+0.0404866im     0.145586-0.126748im      -0.169513-0.198323im      -0.073512+0.0949598im      0.032921+0.0343947im   0.00618144+0.15411im       -0.0277581-0.263609im    0.0588346-0.0833252im    -0.146707-0.129333im     -0.0195096+0.108924im      0.229201+0.000301762im    -0.143357+0.11161im       -0.131883+0.050458im    -0.0431921-0.0857645im      0.113478+0.0457925im   -0.0784019+0.138316im       -0.292854-0.0173922im    0.200652-0.0968823im    0.0850809-0.0866702im        0.236748-0.123022im       -0.158847+0.104367im       0.122571+0.0627965im     -0.317828+0.0137999im     0.134253+0.101627im
   0.0103616+0.00307936im    0.0619147+0.0772444im    -0.209778+0.0904673im    0.0643845+0.178138im      -0.107924+0.095318im      0.0674586+0.0430798im       0.223984-0.218816im      0.0966609+0.208125im     -0.000883617+0.126266im    -0.0869636-0.00786169im    -0.025543-0.0279504im   0.000422004-0.0416313im     0.0561479+0.00842155im    0.248117+0.0225191im       0.126558-0.134951im    0.0742204+0.030556im      0.265772-0.054224im      0.0137831+0.330742im     0.0440051+0.00717714im    -0.0354754+0.0825266im     0.0304307+0.0112292im    -0.155081-0.20488im        0.124613-0.154362im     0.0536772-0.0158016im     -0.0166564+0.0520375im   -0.222193+0.133549im      0.101914-0.128364im         0.311929+0.124013im       0.0762771+0.0504505im     -0.173064-0.064967im      0.0265437-0.0297544im   -0.0881655-0.164493im
    0.245736+0.104197im      0.0927438-0.00842984im   0.0859348+0.0171929im    0.0959165+0.0559685im    -0.0609998+0.0271027im      -0.14841-0.0346698im       0.103308-0.0505331im      0.126378-0.0494305im       0.0205511+0.185238im     -0.155075+0.10963im        0.253591+0.256805im     -0.0439395+0.0826584im    -0.0223833-0.207252im     0.0102245-0.162022im     0.000478377+0.135605im     0.126071-0.0848273im     -0.13082-0.0351156im    -0.0988634-0.106109im      0.200642-0.00552218im     -0.244701+0.0770719im      0.127336+0.0118551im    0.0442798+0.30338im       0.0839453+0.111652im      0.105183+0.0750572im     -0.0206716-0.123367im    -0.142972-0.0766508im   0.00395417-0.0419887im        0.191046+0.0263312im      -0.182844-0.0610243im    -0.0427996-0.103633im      -0.182614-0.00216494im    0.239797-0.0778991im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.02168938218989527 - 0.0205050361215076im
 -0.044260450781359845 - 0.1042317571968913im
    0.1146695850244737 - 0.24641946846889057im
   0.12294807491008426 + 0.09319341424475461im
  -0.10817118147441053 + 0.10265066986093543im
  -0.03698192707768487 - 0.10272017683645698im
  0.019200183158509708 + 0.08298384598608852im
   0.10794814138638645 - 0.20029586606015437im
   -0.0752240882821739 - 0.03236392362473407im
 -0.033167541723048866 + 0.07934786097524033im
   0.24136699000657433 - 0.0310507588863089im
 -0.008897631332231426 + 0.14462771970433475im
   0.15967661151511942 + 0.05250925361202853im
   0.08057376620217477 + 0.024696152030351096im
  -0.11705012862202113 + 0.05685060742424548im
   0.15721752171608594 + 0.1262379196901709im
    0.1790594582889021 - 0.180863082699882im
   0.32300083268987945 + 0.0im
   0.06362680368269408 + 0.02860774466421261im
  0.021026770626397635 - 0.0661268083735748im
   0.07881896015470909 - 0.17683531128378194im
 -0.030317844131550878 - 0.012311179534751342im
  -0.14792577640684418 + 0.003492050999106669im
   0.08824716406517184 - 0.2932225286585288im
   0.17570716707706743 + 0.14681816305619882im
  -0.10556423615589343 + 0.07618710739842956im
   0.03259225526614891 + 0.09889438039768336im
   -0.2509552278481535 + 0.013549809532276885im
  -0.13663228969347896 + 0.08768832449761378im
  -0.07141230852052868 - 0.1467180696094072im
  -0.10789095047571266 + 0.09034635760508895im
    0.1550616782718185 + 0.1869619412307765im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Wednesday 1 June 2022 21:11">Wednesday 1 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
