<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   0.0525283-0.288015im     0.272814+0.137049im    -0.109354-0.0811053im     -0.188013+0.092543im     -0.118937+0.0014938im        0.136628+0.133377im     0.153794+0.0924786im  -0.0829054+0.132158im    -0.00556985+0.201853im       0.129005-0.125778im       0.113995-0.127265im       -0.126288-0.0775142im   -0.0182276+0.00047436im  -0.0728917+0.10377im      0.00142735-0.0297091im     -0.101442-0.197855im     0.0738917+0.146244im     -0.121562-0.128656im     -0.136981+0.142991im      -0.0566513+0.0498414im     0.105609-0.0844054im   -0.0703295+0.0455419im    0.118549-0.0545913im       0.189682-0.0885729im       0.182549+0.037466im      0.123142+0.0229236im       0.0494429+0.262645im    -0.0248918-0.0103103im     -0.143475+0.00833606im    0.0342994+0.182025im      0.298052-0.00194782im    0.0553698-0.0410083im
   0.0675129+0.339577im    0.0318316-0.166865im    -0.110217-0.254168im      -0.139404+0.0567109im    0.0195858-0.000408326im     -0.205853-0.0802238im    0.110998+0.0149911im    -0.13719+0.0204187im      0.250063+0.00278173im     0.139832+0.0413711im     0.0461235-0.0402081im       0.111489-0.0584532im    0.0775954+0.137556im     0.0223586-0.000256743im  -0.0513198+0.017242im       -0.29807+0.153481im     0.0415108+0.0871976im   -0.0978759-0.0324387im    0.0684854-0.147299im       -0.119538-0.0932706im    -0.149952+0.0809298im    -0.115891+0.0501415im   0.0163584+0.159969im       0.0193303-0.156911im       0.0600646+0.113539im     0.0412352-0.0294496im       -0.194752+0.142031im      0.150592-0.0409939im      0.129713+0.1579im       -0.0820161+0.112473im     0.0523258-0.0128601im     -0.308562+0.0279659im
  -0.0180562+0.09819im     0.0405558+0.106026im   -0.0277358-0.332636im     -0.0628897+0.227626im     0.0143551-0.0901366im       -0.126725+0.0335153im   0.0144132+0.182095im   -0.0601791-0.145105im      0.0951802+0.0636637im    -0.0314668-0.0301626im     -0.056961-0.11747im       -0.0731513+0.275603im     0.0129341+0.0215631im     0.123039+0.0485158im      0.240446+0.0990093im     0.0521288-0.121761im    -0.0306872-0.207648im     -0.112951+0.162297im    -0.0142116+0.0135526im     -0.0966161+0.207705im     0.0967135-0.0533802im    -0.108678-0.0242347im    0.193809-0.138118im       -0.122651-0.175045im       0.0273191+0.127916im     0.0322317+0.0787176im        0.127247-0.090023im     -0.203086+0.063334im     -0.0202592-0.147302im      0.0112386-0.175648im     -0.203344+0.227089im     -0.0785524+0.0272436im
  -0.0574078-0.179677im   -0.0626841-0.0800502im  -0.0367263+0.153223im    0.000268198-0.24292im      -0.158789-0.0543037im      -0.0931793-0.0592262im   -0.169852-0.226535im    -0.119547+0.0013794im     0.0511338-0.0562332im    -0.0478678-0.0323919im      0.112103+0.153114im      -0.0633662+0.1644im        0.242703+0.180856im     -0.118794+0.0993761im     0.0262787+0.0804292im   -0.00290439-0.061567im      0.129647-0.118979im    0.00978889+0.0396684im    0.0922207-0.021242im       -0.189545+0.14437im      -0.298619+0.0935441im     0.163789+0.114439im     0.174779-0.0982396im       0.183271+0.043092im      -0.0364445+0.0120474im    0.0913852+0.0631671im        0.172593+0.0662718im    0.0337794+0.101521im     -0.0759392+0.132204im      -0.136389-0.00580744im   0.0646762+0.318879im      -0.114583-0.0230703im
 -0.00899146-0.0821363im   -0.101269-0.0685899im  -0.0763734+0.043017im       0.173875-0.104231im     -0.110954-0.293186im       -0.0442922+0.0317204im    0.163743+0.238415im    0.0505478+0.122803im     -0.0502649-0.0172602im      -0.15226-0.0577667im   -0.00121894-0.134246im      -0.0596542+0.275849im      0.155624-0.0447929im    0.0205688+0.185567im     -0.0151481-0.0230439im      0.247982+0.0400185im    0.0261913+0.18334im     -0.0581197+0.0121335im    -0.105625-0.165881im        0.184701-0.10588im     -0.0591234+0.112347im    0.00164523+0.0501742im  -0.0958686+0.177961im     -0.00595231-0.248619im       0.0882007+0.0609253im   -0.0201043-0.0285458im       -0.121344+0.0538307im   -0.0249901-0.170564im     -0.0430161+0.177415im     -0.0344413-0.263177im     0.0665252+0.00517072im    0.0205042-0.251163im
   -0.054014-0.0407774im   -0.190006+0.0539675im   -0.143106+0.0140094im     0.0230877-0.0754916im     0.108877+0.120509im        -0.113528-0.102377im    -0.182444-0.0564591im   -0.103611+0.0365685im    -0.0570371-0.0303414im      0.219493-0.0955878im     -0.109124-0.0505232im        0.01531+0.059057im     -0.345001-0.121721im    -0.0338999+0.0941054im    -0.0203664-0.0713307im   -0.00615518-0.0999426im   0.00287736-0.119169im     -0.256333-0.1722im      -0.0344821+0.155989im       -0.155638-0.00594391im   -0.202897+0.0442239im    -0.170372+0.0485649im  -0.0647943+0.0581627im     -0.0283696-0.0834213im       0.165375-0.0288149im   -0.0730531-0.257003im       -0.0287148+0.00295071im   0.0737199+0.0639691im      0.176908-0.083756im      -0.148376-0.322238im      0.163137+0.0496509im      0.196766+0.0326906im
   0.0268278+0.0428369im     0.15678+0.0887745im  -0.0804683+0.104049im     -0.0292263+0.0251041im   -0.0146513+0.000195071im    -0.0832168+0.100147im    0.0886232-0.0319861im  0.00371029+0.108173im      -0.187648+0.0540541im      0.154314+0.166948im      -0.267322+0.045268im       0.0706516+0.0491341im    0.0185393-0.0964367im    0.0548037+0.0698508im     0.0681146+0.195959im      -0.136408-0.0575518im    0.0803285+0.181785im    -0.0324262+0.267811im     -0.120722-0.0623552im     0.00579504-0.121058im     -0.238618+0.0653717im    0.0174055-0.0360598im   0.0345787-0.0670557im       0.368925-0.0827144im       0.103921-0.0825638im   -0.0996417+0.291774im        0.0097871-0.222897im      0.189802+0.064712im       0.143528-0.0721044im       0.14912-0.0592933im    -0.147085-0.0260439im      0.129197+0.0715266im
    0.124021-0.197343im   -0.0946332-0.199133im     0.204974-0.0744103im      0.130018+0.213616im     0.0943021-0.00106092im       0.132764-0.087274im    0.0723366+0.0187467im   0.0193669-0.26166im      -0.0481469+0.170145im       0.125204-0.0654193im    -0.0208453-0.171452im       0.0561483-0.0381011im     0.100947-0.121061im      0.259376-0.0170257im     -0.163815-0.150085im      0.0660687+0.104828im     -0.103702-0.0314324im    -0.157197-0.0668953im    -0.200177-0.242639im      -0.0603996+0.0609102im   -0.0942428-0.0492973im    0.0189746+0.104244im     0.103082+0.017296im        0.126713+0.0444532im      -0.125944-0.180945im     0.0321966+0.122024im         0.139648-0.111649im      0.178204+0.0675111im     0.0462654-0.0527484im      -0.28477+0.0587717im     0.076562+0.044419im     -0.0406543-0.0716574im
    0.204454+0.0444943im  -0.0996894+0.0943095im    0.122831+0.112663im       0.145631+0.0729904im   -0.0641256+0.0651408im       -0.147162-0.0390505im  -0.0234904-0.156266im    -0.021485+0.0764044im    -0.0367224+0.0270836im   -0.00339666-0.190937im     0.00607787+0.020245im       -0.124246+0.192245im    -0.0820329+0.0438417im     0.154583+0.00291325im     0.231901-0.217333im       0.033781+0.026631im     0.0073271-0.0111032im   -0.0619446-0.12829im        0.12426+0.200471im        0.280073-0.0914145im    0.0579519+0.0801269im   -0.0420305+0.0329639im    0.250994+0.227535im       0.0940689-0.0249576im      -0.117776+0.103749im     0.0270205+0.170645im        -0.100331-0.0798456im    0.0265214+0.317544im      0.0833785-0.0147401im      0.209389+0.105197im      0.153235-0.0805491im     -0.169883-0.0174977im
    0.153812-0.0645576im  -0.0419128+0.0275919im   0.0437215+0.132501im     -0.0752333-0.189035im      0.173412-0.114488im        0.0982087+0.227389im    0.0962077-0.0274735im    0.117256-0.194805im      0.0147009-0.0577751im    -0.0876402-0.177366im       0.175851-0.0126922im      -0.238354+0.0486638im    -0.173464+0.0886848im     0.186133-0.0362534im    -0.0629812-0.0550943im     -0.273405-0.0566464im    -0.116696-0.166237im    0.00228515+0.146848im     -0.262339+0.0208669im      0.0127851-0.193864im     -0.028672+0.0332667im   -0.0396041+0.0172301im   -0.197772-0.118323im       0.0992699-0.0314248im       0.122694+0.0941558im   -0.0969404-0.172229im        0.0124471-0.106247im    -0.0442632+0.00354167im       0.1301+0.177612im       0.092478+0.0790039im   -0.0810447+0.178842im      -0.180697+0.0477416im
   0.0386689+0.22743im      0.218076+0.2249im     -0.0265338-0.0928894im      0.116899-0.119316im    -0.0326076-0.0760203im        0.197804+0.116615im   -0.0210855-0.157129im   -0.0599745-0.205302im     -0.0925594-0.32483im         -0.1883-0.0232281im    0.00259456-0.257786im        0.109732-0.116114im    0.00376941-0.0158715im    0.0186781+0.00937742im     0.307956-0.00817648im    0.0903492+0.0435563im     0.176939+0.0117574im   -0.0876304-0.136815im    -0.0117394+0.0348996im       -0.03087+0.0120669im   -0.0605219+0.0393477im   -0.0820079+0.0281486im  -0.0657578-0.085402im        0.198888-0.135697im       -0.219828-0.119979im    -0.0534744-0.183464im        0.0558381+0.0824587im     0.189502-0.00273823im   -0.0978352-0.0873954im     -0.074738+0.0211981im    -0.034935-0.0519772im    -0.0744806-0.113275im
   0.0115015-0.193791im     0.134905-0.110732im    0.0337126-0.0031647im     -0.102259+0.0946321im    0.0525101-0.149173im       0.00165366-0.0680353im  -0.0575542-0.0188748im  0.00959433+0.103753im       0.167848-0.202692im      -0.141271-0.270413im     -0.0906903+0.117801im        0.255949-0.24125im     -0.0500942-0.0524662im    -0.157543-0.152861im       0.114156+0.0415449im   -0.00503872-0.172789im     -0.163129-0.120579im     -0.139678-0.231079im    -0.0551149-0.146576im        0.137808-0.0424352im   -0.0674401-0.0358512im     0.241868-0.21493im      0.012369+0.0739867im      0.0542969-0.194551im        0.126122-0.0823455im     -0.14634+0.171097im       -0.0369281+0.0402579im    -0.137108+0.0884112im      0.100781-0.0181498im    0.00539755-0.0672457im   -0.0949262+0.0664482im     -0.108374-0.0371042im
   0.0158223-0.110901im      0.02306+0.18476im      0.117261-0.168565im       0.235536+0.0887182im   0.00961756-0.0290456im      -0.0433216-0.209934im    -0.189165-0.0568239im  -0.0843849-0.0482303im     0.0245613-0.0298224im    -0.0682165+0.025484im      -0.189399+0.106019im      -0.0354601-0.0786764im   -0.0626726-0.0687111im    0.0955014+0.0972956im     0.0216184-0.105112im      -0.114684+0.218465im       0.03304+0.0918711im     0.195783+0.0490753im     0.057049+0.052095im        0.101132-0.0157073im     0.161622+0.183073im     -0.116146-0.105837im    -0.078005-0.144084im        0.168634+0.086319im        0.344477+0.113628im    -0.0331734+0.0922447im        0.223438+0.249314im    -0.0706365-0.0555437im      0.122052+0.189436im       -0.20291-0.00182887im  -0.0842404+0.00959272im   -0.0212836-0.127362im
    -0.21369+0.0718181im  -0.0276043+0.082196im     0.180359+0.0983257im       0.16976-0.00114324im    0.217298+0.191001im        -0.104171+0.0421757im  -0.0386344+0.204079im    -0.094098+0.0104874im     -0.139159-0.0622603im    -0.0281308+0.154744im     -0.0308492+0.0248701im     -0.0721741-0.0706154im    0.0376038-0.0650729im    0.0426683-0.122712im       0.113135-0.106507im     -0.0442537+0.00225406im  -0.0656164-0.013392im     0.0802786-0.0909637im    -0.248006+0.0156571im      -0.156473+0.167377im     -0.144261-0.0878517im     0.101285+0.345398im     0.070462-0.0847769im     -0.0564676-0.0755553im       0.136278-0.158081im    -0.0935634+0.135328im        -0.199791+0.247166im    -0.0905549+0.0274928im     -0.103371+0.128142im       0.221596-0.0490001im    0.0127781-0.0330416im      -0.19267-0.0604675im
   0.0866577+0.0750724im   -0.162928+0.106354im    -0.182428-0.056074im     -0.0799414+0.100893im     -0.153973+0.00779751im      0.0113106-0.153804im     -0.18876+0.171098im      0.21204-0.0361895im     0.0105942-0.0525068im    -0.0212246-0.054771im     -0.0758576-0.0677141im      0.0958027+0.161457im     0.0329887+0.265456im     -0.161439+0.00448486im    -0.026743-0.324901im      -0.154941-0.0835985im    0.0700672+0.0465487im     0.110854-0.163639im     -0.265239+0.104901im       0.0166954+0.0267559im   -0.0165684-0.0118699im    0.0702977+0.0583652im    0.103397-0.0362386im       0.152355-0.0409233im     -0.0828866-0.201802im      0.106319-0.0080176im      -0.0689244-0.125764im     -0.104907-0.111488im      0.0331968+0.188813im     -0.0904103+0.0987698im      -0.2568-0.0991588im      0.164269+0.126115im
  -0.0207186+0.0517808im    0.306997+0.0156039im   -0.115053+0.0397016im      0.175028+0.0924973im     0.268592-0.101117im      0.000529846+0.0375005im   -0.288845-0.0674695im    0.220568+0.0994739im    -0.0243889+0.0751847im     -0.125448-0.0337303im     -0.111414+0.0513745im     -0.0983863+0.177037im      0.132675-0.176392im      0.102714-0.0421638im    -0.0401447-0.00355373im    -0.107107-0.14824im      0.0537052+0.234653im     0.0495769-0.063498im    -0.0493218+0.0082822im      -0.154878+0.118293im       0.01336-0.0829741im     0.021844-0.224661im     0.155051+0.185362im      -0.0701373+0.151955im      -0.0965427-0.0134749im    -0.050417-0.180167im       -0.0961865-0.0335296im    0.0359988-0.179511im       0.156197+0.00169879im   -0.0280682+0.0499736im     0.141118+0.195477im      -0.137616+0.0170523im
   0.0416868-0.063543im    -0.173312+0.0260352im    0.170911+0.0644637im      0.115243+0.174284im    -0.0475118-0.241342im         0.203022-0.0100986im   0.0682311+0.0926097im   -0.121256+0.432903im       -0.21593-0.0270691im     0.0912568+0.12672im       0.0255286+0.057761im      -0.0092275+0.0905728im    0.0463456-0.0263258im    -0.163398-0.154429im       0.027643+0.185371im      -0.215349-0.0112772im    0.0513875-0.180158im     0.0141204-0.113994im     0.0200858+0.0329349im      0.0220017-0.00689059im   0.0857227-0.111401im     -0.110709+0.0699232im    0.104945-0.109705im      -0.0396981-0.0467657im      -0.020105+0.0314861im    0.0201056-0.246469im       0.00336461-0.0474317im     0.189143+0.0500753im      0.141145-0.0228969im      -0.13653+0.0896219im    -0.209234-0.000608683im   -0.135065-0.155008im
   0.0103426-0.0456393im  -0.0670373-0.0233479im   -0.013832-0.111283im      -0.177399-0.0220201im    0.0259987-0.13396im         -0.325137-0.0376755im  -0.0876661-0.174263im    0.0415417-0.00815212im    -0.171279+0.0264034im    -0.0246509-0.0968254im    0.00749518-0.289163im      -0.0502779-0.224963im      0.147048+0.0139493im    0.0176098+0.0280969im     -0.175605+0.036449im      -0.131683-0.072677im      0.264238-0.11741im       0.203186+0.018036im    -0.0112042+0.126469im        0.358167+0.0273616im    0.0197512-0.195333im    -0.0577981+0.0865181im  -0.0103012-0.132917im      -0.0661362+0.071799im        0.028893-0.143075im    -0.0612017+0.107752im        -0.112417-0.0480209im    0.0714457-0.124475im    -0.00149506-0.148484im      -0.011292-0.212069im      0.100827+0.0545875im      -0.15014-0.0776351im
    0.189106+0.129939im     -0.03892-0.0248392im    0.246085-0.0782311im    -0.0987743-0.0178895im    -0.199347-0.026568im        0.0800093-0.055407im    -0.125692+0.0687241im   0.0125791-0.0894284im    -0.0738614+0.00394392im    0.0189087-0.162897im      -0.138679+0.0617702im      -0.120387-0.0339269im     0.128322-0.0506914im    0.0934101-0.134126im     -0.0287687+0.0183718im   -0.00132439-0.218888im    -0.0150006+0.323815im   -0.00928202-0.0220062im     0.191639-0.0781913im      0.0775628-0.0265743im    -0.349668+0.127889im    -0.0371335+0.131004im    -0.068957-0.120533im       -0.191991-0.018585im        0.201722-0.124661im      0.156023-0.219368im         0.059401+0.0158878im    -0.165891+0.0401913im     0.0500442-0.199756im       0.140988+0.143717im    -0.0358074+0.0351638im     0.0428429-0.0788375im
    0.132738-0.0495546im   0.0699416-0.0712585im    0.121191-0.131714im       0.151505+0.0915459im     0.126783-0.048581im        -0.133848-0.138454im     0.150515+0.120096im     0.124701-0.00715264im    -0.136996-0.207985im       0.116174-0.0150533im     0.0780791-0.0279742im   -0.000836157-0.117004im     0.0869293+0.071389im     0.0478884-0.134485im       0.148164+0.173611im       0.076926-0.138097im     0.0257136-0.0314093im  -0.00398575+0.0251823im     0.213181+0.223298im       -0.196663-0.27762im      0.0151631+0.106155im     0.0545665+0.0302613im    0.114571-0.144195im     0.000753715-0.00441408im  -0.000248718-0.0722079im   -0.0840011-0.000872203im   -0.00757508-0.224222im     -0.123188-0.136782im     -0.0594173+0.332667im      -0.102441-0.0161849im     0.276321-0.0306241im      0.125663+0.121425im
    0.136703+0.134743im    -0.100083+0.0485269im  -0.0731335-0.00599157im     0.251322+0.00261138im   -0.111037+0.0866026im       0.0408111-0.0459051im   -0.164115-0.16854im     -0.145717+0.0485027im    -0.0620741+0.258937im     -0.0117868+0.175478im       0.242451-0.0455445im      0.0475161+0.00223593im  -0.0246975+0.211838im      0.225292-0.160157im      0.0262054+0.163076im      -0.105054-0.0759185im    -0.053419-0.0867357im    -0.186616+0.099843im    -0.0187728-0.166738im        0.173745-0.0335655im    0.0527517-0.111509im      0.104137-0.210092im   0.00822745-0.0275866im      0.0402674-0.143512im      -0.0244458-0.261547im    -0.0455411-0.0430234im      -0.0376392+0.237816im     -0.161592-0.118084im      0.0338556+0.0731516im      0.075771-0.0327946im    0.0852516+0.0830177im      0.205901-0.00817449im
   0.0841131-0.211942im    0.0892608+0.0525431im   0.0501303+0.0434144im     0.0452332-0.027125im    -0.0259325+0.156313im     -0.000150762-0.0485829im    0.185493+0.075308im    -0.101601+0.0923022im     0.0156118-0.144503im      0.0904214-0.00772766im   -0.0428214-0.113524im       -0.100481+0.193715im    -0.0988369+0.166795im      0.111999+0.0754574im      -0.11336-0.00154704im     0.128814-0.0708326im   0.00199495-0.124052im      0.153013-0.116735im     0.0806389-0.0690916im      -0.016474+0.150118im     -0.256539+0.123606im      -0.25109-0.453114im   -0.0474518-0.128804im      -0.0885898+0.0679296im     -0.0295912-0.219953im    -0.0524959+0.0959382im        -0.18145+0.0783311im    0.0523224-0.125662im     -0.0611834-0.0169084im    0.00834221+0.0798935im   -0.0978098-0.0848668im     -0.188307+0.113722im
    0.275001+0.104617im   -0.0229978-0.0452602im  0.00913919-0.0806209im     -0.184297-0.16412im       0.209016+0.0447205im      0.00420391-0.15769im     0.0585469-0.205532im     0.142715-0.0435746im    -0.0257898-0.0722598im    -0.0859962+0.148562im       -0.29679+0.175292im      -0.0966208+0.227161im    0.00301231+0.00169937im    -0.18554+0.155777im     -0.0574254+0.179154im      0.0205031+0.121223im     -0.219398-0.0541499im   -0.0482789-0.0618571im    -0.133435-0.0653339im      0.0200375-0.00151617im    0.186549-0.0646445im   -0.0193615-0.0258808im    0.104764-0.229926im       0.0204277-0.131527im       0.0500208-0.162497im     0.0963659-0.0385862im       -0.103388+0.0156676im   -0.0322356+0.0715935im     -0.126001-0.0388139im    -0.0147438+0.064425im       0.23755-0.0754769im    -0.0127723-0.196057im
   -0.100862+0.18174im     0.0377695-0.163353im    0.0952831+0.029395im      0.0806139+0.0651035im    -0.305431-0.04988im        -0.0808913+0.155492im    -0.115537-0.047598im   0.00649726+0.104034im     -0.0196174+0.0267548im      0.191399-0.174105im      -0.189885-0.00978087im    -0.0448354-0.0655657im   -0.0179631+0.241998im      0.109093+0.00121631im    -0.203957+0.0307859im     0.0998284+0.0341875im   -0.0159227+0.170088im     0.0577376-0.16459im      -0.188066-0.0535747im      -0.175534-0.0183927im     0.223055+0.0346796im    0.0485366-0.108344im    -0.035821-0.299873im       0.0241833-0.038571im       -0.115596+0.127935im     -0.290969-0.0953214im    -0.000820979-0.0147199im   -0.0166864+0.252706im     -0.0991409+0.0455837im      0.034882-0.152305im      0.057771+0.0151269im    -0.0684763+0.0177303im
     0.10624+0.0742832im    0.117355-0.0238928im    0.194871+0.230359im       0.138162+0.05934im      -0.097529+0.08055im          -0.23686+0.0869783im  -0.0649936-0.112602im    -0.099163-0.107709im      -0.129915-0.0405645im      0.132756-0.109895im      0.0847307-0.157142im        0.126606+0.172015im      0.003534-0.134459im     -0.325651-0.122224im      -0.115192+0.00368396im   -0.0936188+0.0486592im   -0.0649025+0.0783352im    -0.227953+0.120299im   -0.00583441+0.0687494im     -0.0695756+0.0681489im     0.144206-0.0261039im   -0.0375375-0.0922837im   -0.157981+0.127192im       0.0966185+0.0144743im       0.168842-0.0688743im     0.176418-0.00611911im      0.0370992-0.131259im     -0.188052-0.132645im       -0.25438+0.000595921im    -0.08713-0.0381166im      -0.1104-0.0610992im     -0.221825+0.00419744im
    0.116855-0.0611167im    0.253749+0.153739im     0.198695+0.0653804im    -0.0153023-0.0988024im    -0.245667-0.0891299im       -0.267683-0.0691343im    0.156378-0.0339434im  -0.0382221-0.0195428im       0.12818+0.148869im      -0.183372+0.0650978im    -0.0446629+0.170375im       -0.121829-0.209861im     0.0944651+0.0448505im     0.112521-0.037109im       0.098025+0.0479617im    -0.0662938+0.086034im     -0.125079-0.116375im    -0.0104203-0.116006im     -0.191528-0.0319481im   -0.000982189+0.239258im    -0.0627807-0.041618im    -0.0854728+0.0147491im   0.0918317+0.152243im      -0.0293215+0.0555245im      0.0391381-0.0096914im    0.0832171-0.266417im        0.0164984-0.170574im      0.105571-0.0341586im     0.0125814+0.116034im     -0.0262706-0.222365im    -0.0251275-0.205708im       0.148447+0.131193im
   0.0440807-0.0913616im  -0.0410066-0.0033087im    0.139817+0.0291635im      0.124698-0.214939im     0.0516883-0.16153im         0.0106442+0.107235im    -0.111671-0.0523133im   -0.159392+0.00941575im      0.27926-0.0902419im      0.114411+0.149006im     -0.0782639-0.15902im      0.000910822+0.0284043im    0.0301531-0.00036493im    0.119948+0.278653im      0.0949421+0.0418661im     -0.285366-0.0349463im    0.0979713+0.09287im      -0.187569-0.297351im   -0.00813481-0.00993402im    -0.0355079-0.0599526im     0.165468+0.0404138im     0.108299+0.0546606im  -0.0410379-0.0129168im      -0.325248+0.0741762im      0.0625962-0.0532715im  -0.00985742+0.226637im       -0.0111805-0.18565im      0.0451486-0.0829729im     -0.120993-0.00971235im    0.0783611+0.12787im      -0.101051+0.0545958im      0.169073+0.0183849im
   0.0560044+0.0381546im   -0.177113+0.0898445im     0.19937-0.120589im       0.109622+0.108591im    -0.0558968-0.0619261im       0.0572013+0.179583im    0.0880421-0.0704712im  -0.0598103+0.0734857im      0.264101-0.150785im      0.0674351+0.126585im      -0.105617+0.238577im     -0.00856192-0.048771im      0.159208+0.00515374im  -0.0778111+0.178668im      -0.126545-0.288525im     -0.0510875-0.266443im      -0.04213-0.106955im     0.0310886+0.136196im     0.0805557+0.0190839im     -0.0960185+0.0157698im    0.0302824-0.106im       -0.0917666+0.0373791im   -0.127897+0.107232im        0.232834-0.059962im       -0.163231-0.10326im      -0.121064-0.019426im        0.0968019-0.0116367im    -0.113582-0.229967im      0.0652289-0.152216im       0.140155-0.119621im      0.206921-0.0351945im    -0.0631927-0.0123133im
  -0.0640728-0.0147246im   -0.227552-0.177602im   -0.0793857-0.0451913im    -0.0334578-0.182399im      0.200925+0.125006im       -0.0104365+0.0299766im    0.183748+0.0288143im   -0.174092+0.0846981im      -0.18952+0.131526im      -0.092441-0.0974402im    -0.0219954+0.0687417im       0.106204-0.0313678im     0.236377+0.107135im      0.184735+0.0668874im      0.212326-0.11731im       -0.134165+0.119871im    -0.0632243+0.136415im     0.0441343-0.15666im    -0.00691278+0.147845im      -0.0581143-0.0959685im    -0.043074-0.074184im     0.0905744-0.242356im     0.110182+0.00579844im      0.155929+0.026661im        0.114837+0.0725842im   -0.0550998-0.175949im         0.136792-0.0775694im     -0.15807-0.129107im      -0.181958-0.283912im     -0.0564484-0.0527971im   -0.0901208-0.0841175im    -0.0688987+0.0330521im
  -0.0938015+0.202404im     0.139913-0.0249586im   -0.123565+0.0435687im      0.057806-0.108275im    -0.0335394-0.109264im         0.210855-0.188863im   -0.0899069+0.0682197im   -0.255697-0.0843942im     0.0600155+0.109077im       0.120948-0.277493im       0.127253+0.106749im       -0.058234-0.00916155im     0.32446-0.210463im    -0.0583003+0.191349im     -0.0234022-0.0141557im     0.0766384-0.0783781im    -0.149636-0.184679im    -0.0134698+0.116675im     -0.077547+0.0957949im       0.017979-0.211835im      0.136683+0.106652im     -0.126367+0.0183375im    0.139222-0.0678972im     -0.0164555+0.156734im        0.082953-0.242984im    -0.0903423+0.013045im         -0.16738+0.0319656im     0.064042+0.0571756im     0.0404754+0.0107177im     0.0359222-0.0457618im    -0.110189-0.125938im     -0.0298267+0.0909267im
    0.020215+0.0995922im    0.107872-0.141772im     0.143403-0.222346im      0.0697719+0.0345728im    0.0172731-0.15314im         -0.218402+0.0300418im  -0.0396118-0.0880356im   0.0735562+0.137996im     -0.0818156-0.0403266im    -0.0610656-0.00721813im    0.0658396-0.0268507im       0.119092+0.152192im     0.0720731-0.0621176im    0.0574329+0.0249492im     -0.105396-0.101568im      0.0337222-0.0362859im    0.0703936-0.326872im      0.111154+0.0855148im    -0.226727+0.131165im       -0.132673-0.101352im     -0.185576-0.00819715im   0.0478609-0.115918im    -0.130969+0.171546im      -0.0535106+0.0158388im       0.123416+0.0735169im   -0.0459315-0.0228529im       0.0517463+0.173561im     0.0659565+0.193004im      -0.191433-0.0935815im     0.0550548+0.30677im     -0.0285399-0.0774671im      0.316968-0.0949415im
   -0.143023-0.0720933im   -0.119006+0.0248948im   0.0231037+0.0737569im    -0.0636455-0.1086im      -0.0503413-0.0359804im       -0.127432-0.0346959im   0.0866291+0.0901359im   0.0752348-0.261334im     -0.0139556-0.147332im       0.279359-0.0708688im     -0.181807+0.050999im       -0.154607+0.0842599im    0.0762095-0.125723im     0.0224077-0.164948im      0.0750719-0.0318565im     -0.154253-0.0536667im   -0.0335561+0.039099im      0.106171+0.0738987im     0.162132-0.0643781im       0.131709+0.0169765im      0.18137-0.156835im     0.0485872-0.123675im    0.0977103+0.192846im    -0.000570032-0.249303im      -0.0190377-0.112901im     -0.154265-0.13658im         0.0838939+0.248587im      0.282002+0.0386672im     -0.207022+0.066021im     -0.0395779+0.0843189im   -0.0531883+0.123531im       0.120684+0.164815im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.19861209954847622 - 0.08088963485415217im
   0.12506890274394533 + 0.09252073264150967im
   0.14865938660079372 - 0.06163936168294108im
  -0.11364880599823715 - 0.23792431486608737im
    0.2326453899173785 - 0.09877097108757471im
 -0.014406367270618699 - 0.08333597741994192im
  -0.04151771226696076 + 0.0087186344664733im
   0.17961364797616308 - 0.22610328791646456im
   0.21324581868610468 - 0.010940536988973296im
   0.21214984667120157 - 0.03339805676737555im
   0.14204264134742775 - 0.16536997129836595im
  0.038919087181897856 + 0.13088782161200663im
  0.035515573429613784 - 0.048421389247133205im
 0.0075842316946643845 - 0.06732326178853097im
  0.045107009115082204 - 0.269189733178608im
   0.03280059549048446 + 0.028916384402189937im
  -0.05575061467013537 + 0.06951963243324683im
  0.002067768023302862 + 0.046071046781289905im
   0.10894656033678667 - 0.04747528402760911im
    0.3588330198936005 + 0.0im
  -0.08828710671963413 - 0.005082884672100028im
   -0.3030372160356917 + 0.14018512532868968im
  -0.18748409850415693 - 0.13156176029347627im
  -0.10225416717845807 - 0.03478951408108869im
 -0.024152097152031905 - 0.051054088913186746im
  -0.13383153341379764 + 0.013937246072785452im
   0.09437872273247366 - 0.008193230893317804im
   0.05414760546220246 + 0.08051789428254884im
  -0.06845869819092922 - 0.09444633688766525im
   0.19124074625141002 + 0.0011883620562245718im
  -0.08064713966736972 + 0.043669567916704406im
 -0.029981105798739912 + 0.010984084620268956im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Wednesday 1 June 2022 21:08">Wednesday 1 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
