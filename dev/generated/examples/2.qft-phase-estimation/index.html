<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.00651303-0.354083im    0.0154985-0.0251118im    -0.100405-0.0434507im       0.03885+0.0128151im   -0.0646563-0.0723286im   -0.0274372+0.0851545im     0.0254619-0.00360796im    -0.0752945-0.000271251im    0.0969828-0.0158847im      -0.194616+0.000839376im   0.0973074-0.248025im     -0.130682+0.0184923im       0.151195-0.153053im      0.287785+0.0536919im   0.00143739+0.0250949im      0.134676-0.226053im      0.0251024+0.162557im       0.114257-0.0831391im    -0.0323349+0.029993im       0.113249+0.118178im        0.219801+0.223259im     -0.152901-0.0636098im   -0.0129975+0.244837im      -0.120091+0.0982464im    -0.0909091-0.104565im         0.083377-0.0219003im     0.130486+0.203875im       0.11522+0.149157im      0.0158896+0.0667508im     -0.0411183+0.177731im    -0.0712294-0.065254im      -0.144908-0.154708im
    0.0540441+0.24329im     -0.341639-0.227293im     -0.186069-0.197707im      -0.027958+0.00186788im    0.063946+0.112114im      0.231577+0.139515im      -0.127889+0.13265im        0.0394075-0.184383im       0.0856965-0.0459181im     -0.0726291+0.0510227im     0.0331888-0.097687im      0.138202+0.0142572im       0.184851+0.0189176im     0.142664+0.131487im    -0.0154165-0.0901431im    -0.0384106+0.00993249im     0.156204-0.111623im      -0.155631-0.105613im       0.128413-0.144017im      0.0355427-0.0268457im     -0.0289464-0.075097im      0.123104+0.141578im    -0.0584288+0.0294765im    -0.0839256-0.072257im       0.112828+0.170361im         0.101116-0.0336228im    -0.208382+0.230521im     0.0988646-0.0208257im     0.0488418-0.0236992im     -0.0641175+0.0633814im   0.00407845-0.00206777im    -0.247634+0.0663824im
     -0.16077-0.0903693im  -0.0453183-0.248173im     -0.285163-0.146266im     -0.0187324+0.0835905im    -0.238741-0.0373019im      0.14365-0.158378im     -0.0523432+0.0999143im   -0.000164804+0.104392im        0.262412+0.0779477im       0.137351-0.156636im     -0.0286101+0.222077im    -0.0884188-0.117922im       0.0354669+0.0483289im   -0.0993697-0.260925im     -0.203849-0.128875im       0.135674+0.0497755im    -0.0106755+0.170835im     -0.0377796+0.1426im       -0.0466222+0.0999066im    -0.0506166+0.183673im      -0.0652909+0.0728716im     0.106557-0.0817441im    0.0191047-7.11703e-6im    0.0738028+0.0739769im      0.114793+0.088213im        -0.285661+0.0153799im    0.0209723+0.0159413im    0.0977965-0.0296869im    -0.0322525-0.0227655im       0.148651+0.0183945im    0.0304313+0.0431858im     -0.129519-0.133662im
   -0.0269534-0.141619im    0.0156856-0.108719im     0.0133813-0.146093im       0.134282-0.261176im     -0.172879-0.0213859im   -0.0185445+0.0212795im    -0.0586442-0.0159033im     -0.0339464-0.170802im       -0.186089-0.290455im        0.176934-0.129335im     -0.0549212-0.239767im    -0.0875512-0.0172871im      0.0896673-0.0546701im    -0.212179-0.123426im     0.0217231-0.12507im      0.00447628+0.0493926im     -0.109311+0.179401im      0.0242765-0.0542088im     -0.111069-0.0763237im    -0.0296123-0.0906091im        0.07464+0.0670936im     0.072477+0.0703619im   -0.0268736+0.0317401im     -0.137148-0.31837im      -0.0472901+0.0689386im      -0.0451599+0.219117im    -0.0352712+0.0502771im     0.110243+0.0649245im    -0.0643362-0.0923332im      0.0677139+0.0550846im     0.049925-0.0460195im      0.198024+0.332417im
    -0.061406+0.029462im    0.0405527+0.100082im      0.215139-0.0209928im     0.0126664+0.0790926im    0.0993468-0.199941im    -0.0161634-0.205209im       0.179761+0.0207344im     0.00144948-0.0517046im       0.190971-0.150381im      -0.0866976+0.181262im     -0.0905179-0.0688648im    0.0991077-0.169959im       0.0284578-0.136089im     -0.135983-0.0694052im    0.0381516-0.174831im      0.0248888-0.278468im       0.170209+0.217151im      -0.072221-0.0659243im       0.11387-0.0682878im    -0.0509938+0.0145203im     0.00313437-0.259696im    0.00749993-0.0376546im     -0.14124+0.154056im      -0.100577-0.0914907im      0.355919-0.00963486im     -0.0844763+0.0275551im    -0.176056-0.126214im     0.0675261+0.00917203im   -0.0607416+0.0740889im     -0.0945422-0.0132374im   -0.0624673-0.0927213im      0.117213-0.176089im
     0.185826+0.115307im    0.0874352-0.0612053im    0.0494032+0.0184195im     -0.200875-0.139706im     -0.124721-0.0559389im   -0.0194718-0.349973im      -0.232359-0.0939326im      -0.224174-0.0349063im     -0.0246779+0.0886981im      0.0399006-0.0142597im      0.283703-0.187949im     0.0387301-0.019126im        -0.10214+0.230726im      0.176422-0.17132im      -0.092559-0.078717im     -0.0610707-0.0434215im      0.115158-0.0291746im     -0.100296-0.125328im      0.0895863+0.00734152im    0.0605074-0.151719im         0.11258+0.0491235im   -0.0580821-0.132865im    -0.0487562+0.154522im       0.023924+0.176894im      -0.056951+0.00918755im      0.0315734+0.0616932im    -0.114924-0.0607628im    0.0233893-0.0922166im     -0.240975+0.138722im        0.109612-0.160561im      0.144805-0.0586925im    -0.0227046+0.0827225im
     0.247098-0.0635908im   -0.013638+0.0201448im    0.0274777-0.0039144im    -0.0554975+0.0322944im    0.0377105+0.178203im    -0.0540679-0.113314im      -0.209959-0.457895im      -0.0591019-0.0501879im      0.0573675-0.160116im       0.0215499-0.10341im        -0.19838+0.0523929im    -0.149525-0.0544067im       0.171572+0.140866im    -0.0518987-0.133559im     0.0317091+0.1349im        0.0146434-0.0885266im      0.106178+0.0684159im     0.0783631-0.140873im       0.121138-0.13235im        0.136911+0.140829im      -0.0517373-0.0909935im     0.178967-0.0508695im     0.026519-0.172849im      -0.120226+0.0638074im     0.0165085+0.197737im         0.053071-0.0979777im     0.209753-0.0938412im   -0.0964404-0.0381925im     0.0495224-0.111537im       -0.150386+0.203414im     0.0622379-0.0176339im    -0.0363925-0.0948957im
   -0.0879183-0.148799im    -0.174808+0.0339101im   -0.0617977+0.00648001im      -0.2678+0.220178im    -0.0433825-0.307302im    -0.0559375-0.160693im      0.0048894-0.0540944im      -0.135778-0.313204im        0.111778+0.0194444im      0.0796112-0.1738im       -0.0984857+0.0323228im    0.0090203+0.208831im       -0.171518+0.141596im    -0.0640896+0.108293im     0.0124168-0.158479im       0.114932-0.0869344im      0.030208-0.174821im     -0.0374741+0.0876385im     -0.111167+0.0811119im     0.0895298-0.000565663im    0.0258328-0.139758im     -0.274022+0.0445824im    -0.209439-0.0908188im    -0.0454729-0.100924im      -0.145502+0.0299331im        0.054626+0.0571829im    0.0132824-0.0454549im   -0.0313602+0.0107247im      0.184044-0.058499im        -0.11347+0.0911128im    -0.083208+0.082532im     -0.0541529+0.135896im
  -0.00916548+0.323147im   -0.0646795+0.0820582im    0.0743227-0.0900384im     -0.114904+0.010252im    -0.0292046-0.246013im      0.202464+0.0314513im     -0.117069+0.00814382im     -0.125429-0.0541905im      -0.128139-0.286601im       -0.143331-0.00221349im   -0.0633614+0.105306im     0.0304158-0.117415im       0.0625635+0.133102im     -0.209457-0.0576825im     0.157291+0.104349im     -0.0144985-0.0927057im     -0.217563-0.113451im      0.0390006+0.0446613im     0.0578099+0.0660918im    -0.0617645+0.100337im        0.255583+0.262572im     -0.107073+0.0137904im     0.114927-0.13487im       0.0461802+0.1507im       -0.0182641-0.00531025im     -0.0784854-0.00601873im  -0.0265952+0.078078im      0.110251+0.0489185im      0.125991+0.160926im        0.101229+0.0764119im    -0.108476-0.240434im      0.0454148-0.12154im
    -0.057944+0.0195355im  -0.0731171-0.078013im      0.123966+0.0287167im      0.170451-0.0164599im     0.107464-0.0519126im    -0.114463-0.0390926im    -0.0544283+0.0414964im      -0.118429+0.00321669im    0.00528376-0.0539258im     -0.0305571-0.245424im        0.25713+0.051704im    0.00073052-0.173437im       -0.146244-0.0296964im     0.280589+0.161978im    -0.0828001+0.0245305im     -0.218783+0.124949im      0.0176507-0.0534487im    -0.0203892+0.0467505im     -0.173777-0.188863im     -0.0909241+0.207003im        0.129246-0.157954im    -0.0423205-0.0947853im     0.158674+0.00233882im    -0.125565-0.199033im       0.053456+0.305481im        -0.139125+0.0338466im     0.183204-0.162074im     0.0783536+0.00298353im     0.199415+0.205257im       0.0434866+0.00261707im  -0.0389595-0.0574163im     0.0203364-0.056084im
    0.0213312+0.0220692im    0.102204+0.160488im    -0.0658662-0.104246im       0.298753+0.244488im      0.105742-0.174381im      0.131171-0.00799238im    0.0448696-0.0744901im       0.101204-0.0727626im     -0.0770736+0.157678im      -0.0554138+0.0463505im     0.0260372-0.196974im     -0.142527+0.15483im         0.131377+0.214996im    -0.0846346+0.110856im    -0.0322342-0.0161191im      0.124272-0.0661068im      0.175463+0.0618383im     -0.155249+0.000453788im  -0.0751003+0.0794151im   -0.00723747+0.0993355im     -0.0841303-0.0943021im   -0.0327856-0.0516195im     0.227598-0.0517096im     0.0893134-0.110561im     -0.0319821+0.0793417im       0.0804319+0.00248716im  0.00202794+0.0689429im   -0.0753153-0.180533im      -0.010392+0.120418im        0.381529+0.130459im       0.25131-0.12227im       0.0732015+0.0198307im
    -0.112283+0.0544104im   0.0312719+0.139476im    0.00477438-0.0682384im     0.0564093-0.0619798im    -0.139508+0.11585im      -0.107853-0.180413im      -0.196556+0.0595091im       0.183388-0.139069im      -0.0679747+0.140314im       -0.085838-0.146748im     -0.0987083-0.0247822im    -0.039847-0.414461im       -0.174044-0.127681im     0.0796762-0.0454117im     0.163461+0.222382im      0.0241499-0.0889317im      0.007678+0.018652im      -0.134649-0.0244095im     0.0574891+0.31172im       -0.087632+0.102689im      -0.0690883-0.0970687im    0.0791581+0.00885639im    -0.19529-0.0218208im     0.0859685-0.0796156im    -0.0110885-0.0183936im        0.180426-0.0443851im   -0.0460932+0.102067im    -0.0959618+0.17439im       0.0553046+0.171591im       0.0976571+0.148331im    -0.0400555+0.0423055im     -0.110665+0.161048im
    0.0878193+0.249435im    -0.104908-0.0674677im     0.111176+0.0726989im    -0.0821299-0.0163368im    -0.206782-0.0876238im    -0.102706+0.228567im       0.175456+0.0998542im       -0.12675+0.100224im      -0.0124538+0.0721312im       0.258583+0.0188074im    -0.0264525-0.221383im     -0.105851-0.00824217im    -0.0536952-0.263639im     -0.092726+0.0640208im    -0.062819+0.0014937im    -0.0206375+0.00489686im    0.0473633-0.0768015im    -0.0465791-0.134541im     0.00488163+0.11232im        0.138577+0.109701im     0.000919512+0.173787im     0.0336247-0.0607678im    -0.311238+0.0601603im      0.111106-0.0319055im     0.0187334+0.172163im       -0.0913565-0.156748im      0.091496-0.136669im     -0.167744-0.16484im       0.0635618-0.000122095im    0.0202891+0.22896im       0.191806-0.144359im     -0.0106213-0.0752775im
     0.146408+0.255908im     0.141671-0.145526im     -0.122584-0.0191226im   -0.00315053+0.233711im     -0.111879-0.0242213im   -0.0237858+0.012177im    -0.00540684-0.170167im       0.0138955+0.0235615im     -0.0421013+0.268171im       -0.196378+0.0463146im     0.0827396+0.0460051im     0.230574+0.141697im     -0.00761545-0.23045im      -0.214623-0.296874im     0.0119085+0.150048im     -0.0368982+0.0105925im     0.0540011-0.0237435im      0.126808+0.0138943im     -0.202325-0.110748im      -0.105409+0.0194348im      0.0800579-0.053285im    -0.0495084-0.197795im    -0.0257471+0.0902893im     -0.267697-0.16374im      -0.0298453-0.0859355im       0.0139779-0.080683im    -0.0131791-0.00302354im   0.0868528+0.179958im       0.122662-0.0451994im    -0.00973036+0.0350729im    0.0906266-0.0307304im    -0.0720814+0.14052im
   -0.0357345+0.0875577im   -0.129668+0.00212219im  -0.0740537-0.0641172im    -0.0648423+0.188352im      0.093202+0.0688385im   -0.0960792-0.0746873im    -0.0207339-0.181481im       -0.107758+0.0190232im       0.149075-0.0492078im       0.019716+0.140694im      0.0691362-0.19955im      -0.113106+0.110947im      -0.0837368-0.138212im     0.0626278+0.0219422im    -0.038267-0.236014im      -0.173968+0.0944969im   -0.00747117+0.0249506im       0.13323-0.016625im     -0.0221932+0.137292im      -0.288757+0.134621im      -0.0472362+0.168611im      0.141121-0.0950255im    0.0904652-0.136668im       0.203967-0.0045319im     0.0621591+0.0535038im        0.269671+0.0655026im   -0.0661697-0.128762im    -0.0394991+0.240738im      -0.108501-0.171462im        0.135064+0.0232749im    -0.312809-0.123689im      0.0511197+0.049066im
     0.102942+0.207712im    -0.169655+0.104699im     -0.128235-0.0415185im     0.0254827-0.299742im     0.0107445-0.0336413im    -0.229286+0.0927604im    -0.0551937-0.0388672im     -0.0279193+0.0438809im       0.104522+0.169842im      -0.0162376+0.0632002im     -0.154148+0.197787im    -0.0717804-0.0839802im       0.125811+0.0375002im    0.0981013+0.0545577im    -0.041475-0.0714474im      0.144827-0.370306im      -0.164644+0.0265671im    -0.0645808-0.0168659im     -0.294025-0.0245925im     0.0218056+0.0067112im      0.0917636-0.0379272im   -0.0316073-0.115414im      0.234585+0.0941912im      0.165888-0.178978im      -0.139464-0.00338944im   -0.000294293-0.0509629im    -0.198368-0.200279im     0.0438278-0.0712545im     -0.111087-0.100048im      -0.0914444+0.0321691im   -0.0474969+0.0263312im    -0.0167235+0.0575997im
     0.142942-0.0471293im     0.19344+0.0480213im    -0.119881-0.0322762im      0.042361-0.0199575im    0.0190281+0.0586439im       0.1715+0.198038im      -0.161224+0.0086762im      -0.124587+0.130222im        0.130584-0.0405541im      -0.233102-0.135587im     -0.0399538-0.185311im    -0.0245681-0.0170087im      -0.216277-0.108626im    -0.0466329-0.0157667im    0.0146311-0.177042im      0.0337572-0.209884im     -0.0132352-0.262222im      0.0232504+0.218234im       0.011745-0.0979908im     -0.137889+0.102608im       0.0319467-0.0608228im     0.195283+0.17071im      -0.166061-0.159209im      0.0776559-0.0889471im    -0.0639562-0.174283im        0.0270687+0.222541im     0.0829891-0.171745im      0.103131-0.155682im      -0.120863+0.116978im      -0.0760505+0.00441393im    0.161518+0.0424203im    -0.0621802-0.0772376im
   -0.0288498-0.0415883im    0.103269+0.220921im      -0.15962-0.00265969im    -0.114113+0.066576im    -0.0997712-0.240012im     0.0839257+0.0995025im    -0.0969106+0.191815im       0.0120503-0.0248424im       0.116921+0.0496631im     -0.0645611+0.0354775im     0.0190873-0.0289876im  -0.00806478-0.313878im      -0.0461479-0.0290738im     -0.13205+0.00812345im  -0.0967454+0.114323im      0.0851823+0.129459im       0.125043-0.0429213im     0.0561425-0.246531im       0.196418-0.173497im    -0.00339031-0.210175im       -0.114353+0.17017im     0.00359659-0.0585482im     0.187569+0.0488036im     -0.145025-0.215418im      -0.178055+0.13276im          0.125744+0.109682im     0.0952649-0.185933im     -0.116661-0.0902595im     -0.012535-0.149031im       0.0381837-0.0818701im    -0.201723+0.0354683im     -0.083079-0.0927152im
     0.159633+0.0266387im     -0.1213-0.0318559im      0.22214-0.0516005im    0.00836996+0.0263018im    -0.103127-0.0790506im    -0.019725+0.107313im     -0.0548261+0.112497im        0.226494-0.140406im       0.0752125-0.0898789im     -0.0623173-0.165148im      0.0115201+0.0764222im    0.0548633+0.081183im      -0.0785353-0.0525359im    0.0667339-0.160311im     0.0199474+0.0549107im   0.000807906-0.138609im       0.174753+0.226557im      0.0870827+0.129929im      -0.160856-0.305659im      -0.107433+0.173466im      -0.0356162+0.102839im   -0.00587302+0.163884im     -0.127813+0.0840299im     0.0594585+0.22514im       -0.125039+0.0231171im        0.163309-0.116794im    -0.0152312-0.00469716im   -0.172563-0.236915im    -0.00954688-0.0718064im       0.237318-0.154929im     -0.170148+0.0769128im       0.13125+0.0611909im
     0.103954+0.109218im   -0.0761471-0.0942821im    -0.126432+0.103016im      0.0614485-0.160082im    -0.0967157-0.316114im     -0.120785+0.0793734im    -0.0475363+0.077996im       0.0301087+0.0830013im       0.158842-0.12206im        0.0959422-0.0284594im    0.00533762+0.0196103im   -0.0256123+0.119266im       -0.110226+0.136208im    -0.0786499+0.0415844im     0.258709+0.0567089im     0.0337638+0.119201im      0.0083685+0.0609119im      0.172283+0.133156im     -0.0708872+0.0204967im    -0.0178177-0.266909im        0.100265-0.285512im      0.175422-0.040318im     0.0375332+0.111091im       0.046547+0.0232999im      0.160673+0.0391039im        0.263452-0.0103125im     0.211525+0.12325im     -0.0793536+0.190975im      -0.166535+0.0916359im      0.0771759+0.101386im     0.0570831+0.0597855im    -0.0812208-0.191674im
   0.00272237-0.0165976im  -0.0902423-0.265211im     -0.127501+0.0732415im      0.175351+0.067899im    -0.0334667-0.112826im      0.152476+0.149909im      0.0279119-0.125178im       -0.246572-0.0937996im      -0.089746-0.00843465im    -0.0853243-0.0417298im     0.0874409+0.138092im     -0.213536+0.0625291im      0.0214388-0.155902im     0.0673614-0.153813im     0.0735847+0.0851398im      0.132332+0.0305797im     -0.138975-0.061323im      0.0320337-0.247559im       0.188556+0.0480487im    -0.0597236+0.04384im        -0.152369-0.26735im     -0.0502312-0.0181107im   0.00874552+0.102055im      0.0929163+0.00686717im   -0.0396505-0.0851862im      -0.0779007+0.0113236im   -0.0690292-0.0165297im    -0.242315-0.126027im      -0.132923+0.252534im      -0.0944515-0.0394936im    -0.260293+0.000100421im    0.176927+0.100526im
    0.0268584+0.0946169im  0.00086676+0.0202334im   -0.0179888-0.00655001im     0.174851-0.00798847im   -0.111665+0.120886im      0.129763+0.114081im      -0.111531+0.0896224im      0.0968721-0.34192im       -0.0137544-0.0906533im     -0.0540628+0.0231175im    -0.0402578-0.116364im    -0.0140918+0.0139392im      0.0306846-0.0139211im    0.0359702-0.0557633im    -0.241478-0.00862714im    -0.160285+0.00783588im    -0.156741+0.0874902im      -0.16266+0.135265im      0.0817476+0.0229073im     -0.154082-0.139273im       0.0382198-0.158414im     -0.254333-0.40868im     -0.0819643+0.00286366im     0.131697+0.140987im     -0.0689068-0.0170411im       0.0278769+0.0960458im     0.115171-0.0727604im   -0.0727287+0.0584038im     0.0681216-0.213954im       -0.139476+0.0483101im    0.0950923+0.0972449im      0.104867-0.254138im
   -0.0225717-0.0461543im  -0.0864659-0.234282im      0.419328+0.0335192im     -0.185168+0.168613im     -0.118568-0.0190191im    0.0212229+0.0428753im     0.0053812+0.0649893im        -0.1186-0.0930081im    -0.00986189+0.0917404im     -0.0210587+0.113651im      -0.116069-0.0897953im    0.0747489-0.0314997im       0.107712-0.0251036im    0.0547111+0.0660848im     0.101427+0.225153im     -0.0056306-0.105111im      -0.122197-0.109094im     -0.0317442+0.145462im      0.0130503+0.00218108im     0.201482+0.153622im       -0.128329-0.0577174im     0.152092-0.227175im        0.1511-0.0537573im     0.0106801-0.150341im     -0.0179904-0.0277307im      -0.0136077+0.236619im     0.0866782+0.0785984im     0.127331+0.00638934im    -0.273769-0.0923914im       0.186339-0.0570984im   -0.0371497+0.202613im     -0.0360059-0.0352627im
   -0.0612305+0.0325504im  -0.0887679-0.0693655im     0.134619+0.286467im      0.0322617+0.121003im     -0.139185+0.0145369im   0.00563945-0.0491803im     -0.149181-0.0833802im      0.0624962-0.151892im       0.0459278+0.0850579im      -0.225853-0.0195449im    -0.0620238+0.0805448im     -0.13688-0.039565im      -0.0285896+0.0425182im    0.0203893-0.0715792im    0.0470486-0.198987im      -0.153312+0.243202im     -0.0809086+0.117508im      -0.213103-0.0878871im     -0.186891+0.0207815im     0.0762484-0.0516853im      0.0606125+0.169849im    -0.0262182+0.216599im     0.0422296-0.000504672im  0.00386656-0.29311im        0.123535-0.265391im        0.0812703-0.129385im      0.115546+0.0778812im   -0.0223605-0.182363im      -0.149551-0.0496186im      -0.124998-0.0235781im    0.0429765-0.193879im     -0.0592959-0.181853im
    -0.190935+0.0538379im  -0.0566383+0.103683im      -0.17883-0.0879402im      -0.10829+0.0131837im   -0.0612373+0.12236im      0.0507309-0.0097291im    -0.0220738+0.142388im      -0.0779389+0.0206908im       0.218501+0.00828426im      0.229045+0.0277779im     0.0519268-0.0847979im    0.0602968+0.0150357im       0.111864+0.201561im      0.112176+0.0458734im     0.179264+0.211513im      -0.161471+0.0215145im     0.0153764+0.0357242im      0.013365-0.21167im      -0.0649266-0.194204im     -0.0453172+0.190181im        0.113776-0.157804im     0.0207527+0.0258877im   -0.0980289-0.0787236im    -0.0909284-0.0670854im    -0.0862307-0.470664im        -0.119686+0.0017372im   0.00496426-0.107284im     -0.152988+0.0672166im    -0.0134121-0.0635421im       0.126342+0.0746776im    0.0701409-0.0721003im      0.209038-0.0624329im
    -0.127502-0.0279176im   -0.105979-0.0342791im   -0.0646097+0.0162303im     -0.011288+0.0637189im     0.176979-0.168099im     0.0746308+0.0794226im    -0.0648277-0.097656im       -0.112321+0.0450342im      -0.126302+0.0196212im       0.092502-0.212591im       0.142247-0.281077im    -0.0670725-0.0942544im     -0.0215465-0.00144219im   -0.195202+0.111655im     0.0249309+0.124571im       -0.15629-0.174124im      -0.169892+0.2529im        -0.111703+0.217201im       0.078048+0.0612001im   -0.00947591-0.00166268im     -0.039218-0.0706183im     0.125337+0.00301525im   0.0677274+0.0513444im     -0.115926+0.0458649im    -0.0507146-0.101213im       -0.0219849-0.369361im    -0.0563862-0.102992im    -0.0567551-0.00519342im    -0.015249-0.162423im      -0.0882203-0.297358im     0.0180507-0.00859551im    -0.241012+0.0444857im
     0.191007+0.0604779im  -0.0983939-0.151241im     -0.189244-0.0094376im     0.0365183+0.226461im    0.00959237+0.00342316im  -0.0300371-0.171099im     -0.0572009+0.206137im        0.277503-0.0911563im      -0.279311-0.0283158im       0.166095+0.057037im      0.0185395-0.0772376im    -0.055453+0.0899932im     -0.0628073+0.0432164im     0.176486-0.0789952im    0.0350448+0.120514im     -0.0192254-0.223974im      0.0400532-0.0568072im     0.0727543+0.11229im       0.0257097+0.148315im      0.0435434-0.107093im       -0.114962+0.143687im     0.0458255+0.224283im     0.0986595+0.0453919im     -0.125106-0.094169im      0.0104986-0.0140149im       -0.115817-0.0144943im    0.0780603-0.326954im      0.124698+0.0750109im    -0.0940236+0.0706343im      -0.132575+0.0947915im    -0.082814-0.0182173im       0.18046-0.17667im
   -0.0721479+0.0280118im    0.183527+0.0310705im    -0.205723-0.124026im      -0.108237-0.0845866im   -0.0317321+0.141077im     -0.139086-0.100659im        0.02083-0.121549im       0.0422571-0.058171im        0.057003-0.162713im       -0.101582+0.035697im      0.0458056-0.159281im      0.261723+0.18019im     -0.000363544+0.0124779im   -0.0145389+0.102772im      0.312615+0.056938im     0.00360912+0.113747im      -0.152358+0.051im         -0.110181+0.117673im     -0.0195548+0.0605398im    -0.0885965+0.0302482im     -0.0836093+0.12998im     -0.0391371-0.147855im    3.98301e-5+0.152824im     -0.0189977-0.100896im      0.0819029+0.106795im        -0.140428-0.0845829im    0.0472449-0.0241615im   -0.0687705-0.45169im      -0.0536853+0.0839123im    -0.00885143+0.146525im     -0.220361+0.167807im     -0.0642214-0.0525448im
   -0.0375947-0.070335im    -0.104946-0.144604im     0.0603422+0.0208515im      0.158752-0.0694213im    0.0521562+0.0204153im    0.0570232-0.00193161im     0.136388+0.0436801im     -0.0169086+0.327533im       -0.179898+0.000551072im  -0.00508548-0.0722498im     0.0913275+0.0509891im    0.0444084-0.139407im       0.0031544+0.254732im     0.0212068-0.18761im       0.176269-0.119347im     -0.0480939-0.17816im        0.290934-0.188669im     -0.0373672+0.0893353im     0.0810385+0.0895834im     -0.168079-0.024918im       0.0776307+0.0340819im    -0.156238-0.202944im     -0.128514-0.0944002im    -0.0688194-0.195986im     -0.0739578+0.000388592im     0.0408936-0.0623839im     0.058299+0.167514im     -0.115007-0.105924im      -0.113906-0.313196im      -0.0370174+0.124296im     -0.173554-0.051698im     0.00944322-0.0336836im
 -0.000713182+0.0171918im    -0.13281+0.120525im     0.0347369+0.0134267im    0.00538125+0.0631944im     0.102306-0.0403818im    -0.102128+0.018109im      -0.178912-0.0366364im   -0.000634009+0.0371192im     -0.0615299-0.0417122im      0.0444579+0.185584im      -0.162718+0.0252458im    -0.177144+0.15276im        -0.056982+0.0421292im    0.0868898-0.0223325im    0.0712771+0.116221im      0.0129806-0.0876928im    -0.0361381-0.0111384im     0.0559489-0.229913im       -0.10316+0.120322im      -0.429518+0.00733999im    -0.0429312+0.0260236im    0.0144948+0.0325559im    -0.195362+0.15172im       -0.118888-0.0603085im    -0.0311283+0.131526im        -0.265154+0.222505im     0.0875373+0.188867im    -0.0213556-0.058049im      0.0488456-0.0779826im      0.0469509-0.3347im        0.150545+0.0236073im     -0.213663-0.120899im
    -0.118055-0.0179124im  -0.0110656+0.117262im    -0.0968162-0.0610604im    -0.0329972+0.0436167im    -0.126026+0.0944758im    -0.248039+0.0402196im     0.0274751+0.0833372im      0.0803847-0.0988159im      -0.168778-0.0183106im     -0.0273186+0.0681252im     0.0966852-0.0379775im    0.0946987+0.0582855im      -0.343773-0.0337783im    0.0351458-0.0907153im   -0.0188091-0.127431im       0.177619-0.0948918im     -0.201195-0.000677292im   0.0682387-0.0167596im     0.0976664-0.264301im       0.127327+0.097017im      -0.0729076-0.170822im   -0.00382681-0.036009im     0.0973396-0.234488im     -0.0601635+0.037854im     -0.0557287+0.136669im        -0.129901-0.0790735im   -0.0490345+0.237222im     -0.109794+0.0472891im     -0.242694-0.0750098im    -0.00770647-0.00847007im   0.0453484-0.369931im     -0.0947141-0.120155im
     0.183255+0.131816im     0.118331-0.19557im      0.0855513-0.207755im      0.0372708-0.0514456im     0.207358-0.0636201im    -0.102041-0.210801im       0.157598+0.268973im      -0.0456791+0.0399024im       0.107131-0.0597037im      -0.197763-0.30431im        -0.12598-0.036926im     0.0744117+0.124862im      -0.0858807-0.0425413im   -0.0483126+0.0442653im    -0.144469-0.0427367im     -0.106751-0.114498im      -0.148901+0.0513473im    -0.0185757-0.394307im      0.0130809+0.117945im     -0.0255335-0.0592083im     -0.0722348+0.0261822im   -0.0390522+0.0595089im     0.155581-0.159144im     -0.0302325+0.0341422im   -0.00506991-0.130705im       -0.0700055-0.0473607im     0.175771+0.0866247im    -0.134683+0.0339096im    -0.0498915-0.103298im         0.04854+0.0753028im    0.0301686+0.14045im      -0.0865152+0.0318848im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.002761777337368543 - 0.16860223977171435im
   -0.06635089867834432 + 0.15127452582319845im
  -0.012632485560271512 + 0.06930673417446964im
  -0.055327512657075216 + 0.010646884366953574im
    0.21894607793137294 - 0.1867846476505725im
    0.37711258605568365 + 0.0im
   -0.04880070019476312 + 0.0793903127873542im
    0.09710795198435872 - 0.006363751271304577im
    0.05240721578405252 + 0.06652096771250711im
   0.021288581430940916 - 0.09231678952096206im
    0.07056128990874176 - 0.07974355584387437im
  -0.058466315928385394 - 0.1745031659354663im
  -0.013865619919484774 + 0.06316836243791177im
   -0.02623025328646273 + 0.031835241130773614im
   -0.06342743343705612 + 0.1775279986159868im
   -0.14049777906097802 - 0.10721148002691125im
   -0.24563257013825796 + 0.20286045214552292im
    0.04211559758473804 - 0.2111185111994232im
    0.06436068509584932 - 0.20092233628171507im
    0.19213480424287493 - 0.014156272660727207im
    0.10815163080610796 - 0.042739680071163945im
    0.11751589146310214 + 0.2208475309166168im
   -0.20118392253468514 + 0.1671144969321251im
    -0.1409466519162024 + 0.010908721274306199im
   -0.05753241660229664 - 0.07458990098194543im
    0.08389992173163016 - 0.04367410010487989im
    0.11971925476866682 + 0.07209980751144im
     0.0913110948781678 + 0.060828540153698485im
    -0.2501463494579408 + 0.11717737509328355im
 -0.0069161064962785235 - 0.1557092961152607im
    0.07475933474871023 - 0.062325797758076146im
    0.07236405098321809 - 0.01685612387751576im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Wednesday 1 June 2022 21:09">Wednesday 1 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
