<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
    0.46282-0.0304064im       -0.092355-0.0276851im      0.100439+0.16686im       -0.172607-0.0253683im   -0.0185386-0.143734im     -0.0354982+0.00871325im    0.181356+0.0381442im      0.111198+0.0998807im    0.122517+0.039986im     -0.0682237-0.101058im     0.00113892-0.067383im     -0.0584555+0.0019537im    0.0853174+0.0949336im      0.143796-0.199553im      0.0559054-0.00428946im    0.0231508+0.221433im     0.0267859+0.00280996im     0.203349-0.038873im      0.0206431-0.0745177im     -0.0756947-0.0265381im     0.0986051-0.0614222im     0.0526777-0.0508772im   -0.00631088-0.141059im     0.0560796+0.118921im      -0.168674+0.276602im       0.155164-0.180333im      -0.104192+0.257841im       -0.14243+0.0302776im     0.197801+0.0624441im      0.129148+0.0112807im     0.0434694+0.0412782im    0.121546+0.0941581im
    0.11055+0.025739im         0.344564+0.0254617im     0.0764341-0.0549503im     -0.145364-0.0801771im     0.119729-0.148663im      0.0236559-0.103996im     -0.188564+0.0240983im    -0.0385433-0.0711218im  -0.0676048+0.0247745im     -0.143254+0.0297905im    -0.0371444-0.0972584im      0.102858+0.324397im     0.0104248+0.135545im      0.0411615+0.15541im      -0.0226595+0.0813033im      -0.02466+0.0123411im    0.0326653-0.126402im     0.00911665+0.0529225im    -0.0950188+0.0617254im      -0.178104-0.347835im      -0.187742-0.231104im      0.0949674+0.0691342im     -0.123513+0.112911im     0.0603471+0.096241im      0.0357371+0.111269im     -0.0632113-0.128623im     -0.0133765-0.0902649im    -0.0667579-0.0861055im   -0.0350928+0.105922im      -0.211059-0.237959im      0.0873247-0.158458im    -0.075989-0.00275453im
  -0.128408-0.092538im        0.0586077-0.0363015im      0.478466-0.0854188im    -0.0695726-0.0329437im    0.0466081+0.0595438im     0.0404755+0.190133im     -0.107304+0.0807333im     -0.126637+0.0344793im  -0.0955119-0.153692im    -0.00242373+0.0238695im     0.0805379+0.0141567im   -0.00680619+0.0401909im    0.0704569-0.135429im      0.0415213-0.0203841im      0.148073-0.164013im      0.0240873+0.0858598im    0.0710624+0.316094im     -0.0276443+0.0351678im    0.00350787-0.000317897im    0.0747178-0.144646im       -0.17774+0.140314im     -0.0799356+0.149639im     0.00155208+0.102645im     -0.160955-0.13908im       0.0621415+0.0387452im      0.249099-0.10794im       -0.215217+0.240676im     -0.0642312-0.0188498im    -0.085467+0.0240157im    -0.0742653+0.101787im     0.00887938+0.169439im    -0.121118+0.0324442im
   0.146574-0.0871574im      -0.0204322+0.237848im     -0.0326791-0.201748im       0.406053-0.233937im    -0.0371559-0.0961564im     -0.102867+0.0638894im   -0.0706845-0.0418777im       0.10253+0.0759468im  -0.0720067+0.00826461im   0.00351769+0.20842im      -0.0548033-0.0396471im     -0.171178-0.0644222im      0.13774+0.0504506im      0.132392+0.0351301im    -0.0142143-0.139352im      0.0332163+0.189715im     0.0208248-0.212694im      -0.117756-0.0580521im     0.0426149+0.302206im      -0.0136782+0.0875159im     -0.237723-0.00620593im     0.008017+0.12676im      -0.0869751+0.0139866im     0.111271-0.117475im      -0.209688-0.133466im     0.00908315-0.00741847im    0.0566229+0.0037488im    -0.0452075+0.022419im     0.0843296+0.0219092im    -0.0212146-0.0139946im     0.0204097+0.216794im    -0.020906+0.16188im
   0.126208-0.0577297im        -0.15628+0.124732im       0.107573-0.119916im      -0.183867-0.121125im       0.27556-0.161032im      -0.126545-0.0493664im    -0.126787-0.187134im      0.0584053-0.0196225im  -0.0391107+0.228248im     -0.0330624+0.130016im       0.276609-0.127541im       0.139029+0.0576159im    -0.106022-0.182805im      -0.150931-0.149978im      0.0396099-0.0171636im     -0.110879-0.221926im     0.0134572+0.0588849im     0.0828474-0.00527607im    0.0581063+0.163996im     -0.00850314+0.134294im       0.139296-0.115501im       0.231948-0.138041im      -0.014664+0.0678959im    -0.038587-0.115994im      -0.122956-0.0736467im     0.0183827+0.11405im       -0.056975+0.0616296im      0.133871+0.0792979im     0.107412-0.00750338im    -0.178674+0.0797469im    -0.0474394+0.0836308im  -0.0631486-0.195427im
   0.100498-0.177457im        0.0581539-0.0629903im      0.125277-0.0097798im      0.129293-0.0734025im    0.0353736+0.0306246im      0.503301-0.109887im     0.0325957-0.0918329im    -0.0126115+0.086253im    -0.129542+0.188801im       -0.08316-0.0372493im     0.0913468+0.0059499im    -0.0596783-0.0863981im    -0.173216+0.148454im      0.0626169+0.282346im     -0.0828329+0.0319652im     0.0154838-0.115712im     -0.143331-0.053252im     -0.0053274-0.00813828im     0.113744-0.152875im      -0.0915739-0.045318im      0.0210908+0.0292349im     -0.151568-0.114511im      0.0280339+0.125595im      0.170626-0.268259im     -0.0395217-0.00718651im     0.199443+0.0520613im     0.0740517+0.173138im      0.0890119-0.0487481im     0.169484-0.0726158im     0.0172334+0.0757188im      -0.10228-0.156847im    0.0127532+0.0283956im
  0.0150235+0.0590421im      -0.0796406-0.0526833im     0.0754239+0.052522im      -0.306793+0.209206im     0.0156329+0.0708529im    -0.0395318-0.0458588im     0.178288-0.0664997im    -0.0817583+0.136735im    0.0439781-0.11419im      -0.0805725+0.0873217im     -0.256783-0.0799943im     -0.115918-0.0385528im     0.147118+0.147034im     -0.0582157-0.0224333im     -0.192512-0.111485im     -0.0866668-0.0697597im    -0.208071-0.133777im    -0.00266009+0.108891im       0.218843-0.0629563im     -0.0717051+0.0544251im    -0.0424551-0.0100107im     0.0762487+0.0238737im     -0.174152+0.111197im    -0.0525064-0.231096im      -0.148237-0.250311im     -0.0197683-0.02671im       0.0660204+0.165538im       0.166278-0.0082871im    -0.201764+0.192159im      0.0238283-0.198702im       0.126531+0.117302im    -0.101363-0.0429352im
  0.0851707-0.134251im         0.104866+0.0546199im     0.0395023+0.000184424im   0.0300594-0.030891im     0.0190868-0.0278412im      0.180375+0.00804053im   0.0838351-0.133967im       0.242682+0.0575495im      0.1058-0.0111311im    -0.0849634-0.149592im      0.0382414-0.0250735im     0.0359832-0.246475im     0.0697901-0.0880185im     -0.118634+0.145726im     -0.0407646-0.0325532im     -0.209155+0.0455915im    -0.264591-0.0669277im       0.21005+0.0825191im      0.023153+0.240952im      -0.0883513-0.00168687im     0.213484+0.118526im      0.0221487+0.174265im     -0.0408836+0.104586im     -0.215344+0.0502351im      0.281499+0.0593906im     -0.113116-0.0524302im     -0.128584-0.214562im      -0.207094+0.00570575im  -0.0405362+0.00869388im    0.0764021+0.037239im      0.0979559+0.106853im    -0.237712+0.0283294im
 -0.0225183-0.0820144im      0.00749025-0.12368im      -0.0751871-0.0884458im     0.0620943+0.115188im     0.0909655+0.0261161im    0.00646289+0.0455239im    -0.254949-0.0915736im     0.0140968+0.250255im     0.435446+0.0811747im     0.0672405+0.101489im      0.0235632+0.234486im      0.0347266-0.00203708im  -0.0726989+0.0732547im      0.109836-0.0247907im    -0.0175444-0.168467im     -0.0775968-0.0118614im    0.0148599-0.116484im     -0.0148158+0.0410337im     0.0764994+0.041782im        0.259362-0.0797002im    -0.0468677+0.163922im       0.183512+0.0850988im     0.0504236-0.055425im     0.0207838+0.081371im       0.163896+0.0191913im      0.148641+0.100499im     -0.0728559+0.1501im       -0.0170556+0.0436101im     0.150588+0.0191801im     0.0289483-0.376311im     -0.0657878-0.133943im    0.0072139-0.129404im
  0.0118353+0.143367im        0.0172374-0.027592im     -0.0325329+0.00304342im    -0.179762+0.119593im     -0.109319-0.07817im      -0.0501169+0.00626813im   -0.250076-0.214377im      -0.165451+0.0482076im   -0.144011-0.127068im       0.453725-0.12633im       0.0908287-0.0795054im     -0.215004-0.0780302im     0.133748+0.0356844im     0.0344925+0.0922998im    -0.0526432+0.0844807im        0.1891-0.123893im    -0.0373558-0.145659im       0.208618+0.0466295im     -0.231177+0.123903im      -0.0520615-0.0545765im   0.000479815-0.0927452im    -0.0427667+0.0454402im      0.149774+0.111195im    -0.0124386-0.114809im       0.043962+0.0349355im    -0.0197949+0.0237932im    -0.0613746+0.0792624im     0.0326571+0.224697im      0.198933-0.100069im       0.120004-0.0584705im    -0.0521718+0.0813535im  -0.0578498+0.0839113im
  -0.175087-0.183929im         0.178606+0.0481466im     -0.168403-0.0495588im    -0.0951169+0.078469im     0.0962242+0.0746473im     0.0215121+0.1558im       0.0463343-0.192681im     -0.0856063+0.123204im    -0.154166-0.0945098im     -0.177557-0.0109197im      0.169222-0.0783912im     0.0010631+0.0284738im   -0.0597543+0.173793im       0.119329-0.170502im       0.101044+0.0270237im     0.0302154+0.0486542im    0.0751745+0.110127im       0.282981-0.0652817im      0.149695+0.0594115im     -0.0787737-0.0551659im    -0.0406479+0.160131im     -0.0404628-0.194418im        0.17626-0.0888882im     0.142013-0.00148762im   -0.0615976+0.0806103im     0.0696875+0.079734im        0.16348-0.268077im    -0.00711043+0.0045234im   -0.0660849+0.199567im         0.0807-0.178965im      -0.152064+0.259346im    -0.053921+0.0575788im
   0.192372-0.0669745im      -0.0684153+0.201809im       0.119372-0.180377im     -0.0293234+0.222901im    -0.0495988+0.0274574im    -0.0620104-0.0229388im   -0.0995627+0.220165im       0.189631-0.171528im     -0.11745+0.12039im       0.0155866+0.0086523im     0.0192439-0.116254im       0.252379-0.090104im      0.149758+0.132231im       0.216655+0.0298262im    0.00932883-0.208733im       0.297967-0.0864114im    -0.152438+0.058537im     0.00598619+0.0576907im    -0.0321489-0.168265im        0.202812-0.188058im        0.12514+0.0693835im     0.0211627-0.0272643im     0.0446375-0.0198365im    0.0549576-0.0528344im    -0.0447242-0.161817im      0.0256689+0.068755im      -0.103218-0.278378im       0.020778+0.0795168im    -0.026704+0.0474207im      0.177161-0.0419033im     0.0663176-0.0742119im  -0.0225324-0.0416637im
   0.147487+0.055331im       -0.0888789-0.193638im     0.00353857-0.0382526im      0.186169+0.00716747im   0.0961005-0.211598im      0.0942074+0.0289098im    0.0354326+0.043159im      -0.297475-0.339532im      0.13287-0.148265im     -0.0481928+0.0422675im      0.214032+0.0283659im     0.0645304+0.216813im      0.256024-0.135691im    -0.00469006+0.224938im     -0.0732679-0.0869544im     0.0684561-0.0438824im  -0.00747873-0.0957928im     0.0115173-0.0298299im      0.256308-0.0233099im     -0.0596004+0.105073im     0.00356948+0.0190647im    -0.0533499-0.0317527im     0.0308674-0.0252952im    -0.166648+0.0839489im     0.0250597+0.0664469im    0.00671898-0.104285im      0.0183229-0.0929111im      0.178041-0.0804754im    0.0718528+0.0547904im      0.251276-0.0937865im     -0.125511+0.162939im   0.00584751-0.10035im
  -0.172003+0.066984im       -0.0755051-0.00267248im    0.0566405+0.117996im      -0.113289+0.113669im     0.0861751+0.0660438im    0.00517479+0.120804im     -0.160662-0.20226im       0.0340316-0.0980017im  -0.0995783+0.0853284im     -0.112754-0.0641007im    -0.0137828+0.0567634im    -0.0369712-0.0618921im    -0.176552-0.240358im       0.362724-0.134848im      -0.215428-0.243879im      0.0145051+0.0418117im    -0.188089-0.256082im      -0.177801+0.0332143im     -0.043732+0.0427922im     -0.0355974+0.0179098im    -0.0803174-0.11435im      -0.0237124-0.22269im         -0.1105-0.125616im      -0.10444+0.075303im    -0.00162546+0.0464809im     0.0147053-0.266294im     -0.0359422-0.0807186im    -0.0485218-0.087068im     0.0408529+0.0269469im     0.0256099+0.121634im      -0.195913-0.0674373im  -0.0694543+0.119949im
  0.0793218-0.0845573im         -0.1378-0.0962511im     -0.185644-0.0112664im     0.0539642-0.0484593im    0.0949579+0.183536im      0.0389202-0.168449im    -0.0590366+0.166546im      -0.123369+0.0997239im  -0.0593389-0.0582586im      0.055252+0.0576028im     0.0482886-0.0587026im     -0.239771-0.0782422im   -0.0402161+0.00891281im   -0.0842052-0.0767078im      0.518948-0.199853im     -0.0406064-0.0330151im    -0.111794+0.0184794im    -0.0514125+0.00536884im    0.0685076+0.0159257im      0.0882163-0.168787im     -0.0183665-0.0395361im    -0.0501294-0.20822im       -0.136975+0.181273im     -0.135463+0.00807195im   -0.0340701+0.110752im      -0.295666-0.167586im     -0.0237165-0.043983im      0.0572226+0.0467575im      0.12766+0.149972im      0.0365809-0.0113349im    4.46275e-5-0.133692im   -0.0964381+0.0358594im
   0.126482+0.00951931im    -0.00577417+0.209991im      0.0840878-0.0524273im    -0.0359434-0.138931im     0.0749552+0.0806141im     -0.155207-0.128828im       -0.2389+0.0561469im     -0.225696-0.0538503im    0.103497+0.0326371im    -0.0282423+0.0798655im     -0.224924+0.227187im     -0.0934005-0.0647624im   -0.0235424-0.0855076im     -0.129351-0.0113721im     0.0875046-0.0271423im      0.244701-0.117717im     -0.104179-0.201752im       0.136423-0.104482im      0.0941942-0.0505733im      -0.174661-0.0456247im      0.257224+0.0705161im     -0.188442-0.0570852im      0.158336-0.150606im     0.0242485+0.0655237im      0.134886+0.00537795im     0.119157+0.101805im         0.1425+0.114599im      -0.157391-0.153273im      -0.16119+0.143874im      -0.136424+0.0774801im   -0.00237806+0.0369758im  -0.0939338+0.0891355im
  0.0588594-0.343347im        -0.180412+0.097568im     -0.0491821+0.192175im      -0.164218-0.0116743im     0.257043+0.150345im       0.146579-0.0478144im    -0.141552+0.168982im     -0.0555523+0.0830112im   -0.077316+0.0724871im     0.0667089+0.0359599im    -0.0784133+0.153507im      0.0461321-0.0709018im     0.243019+0.0119873im      0.032286+0.142284im      -0.238128+0.239455im     -0.0810274+0.0236626im     0.346167-0.0326349im    0.00799186+0.0513619im     0.0630518+0.101956im        0.103068-0.052379im      -0.114763-0.0440963im     -0.108918-0.181844im      -0.019124-0.0516878im    -0.112876+0.0834133im     0.0576544-0.165235im     -0.0721704-0.0720267im    -0.0620276-0.0444476im    -0.0986167+0.151989im    -0.0039297+0.0390231im    0.00632876+0.0726321im     0.0251138+0.0982074im      0.1116-0.015381im
 -0.0362773-0.00418101im      -0.131386-0.113944im    -0.00174407-0.210798im     -0.0399579+0.0235931im      0.11543+0.286806im      0.0760237-0.0838462im     0.122361+0.157158im        0.12732+0.0261612im    0.164269+0.0521154im      0.206197+0.0034787im     0.0186397-0.127554im     -0.0503928+0.0695321im    -0.155581-0.245383im      -0.146934+0.0648976im     -0.072752+0.0298981im      0.194257+0.219733im    -0.0646142-0.0674233im      0.338643+0.00354661im   -0.0162685-0.0363245im      0.0158988+0.0126019im     -0.265719-0.261032im      0.0537262+0.0546462im    -0.0260065-0.1508im       0.0893336-0.180149im       0.055927+0.00942665im    0.0477351+0.0413574im     -0.113012-0.153459im     0.00259067-0.245339im     0.0189913+0.0721764im    -0.0289162-0.0160674im    -0.0483996+0.0855764im    0.065107+0.00742462im
 -0.0208574+0.0587839im       -0.206088+0.0959832im    -0.0284736-0.129055im      0.0292281+0.0171127im     -0.10975+0.0618257im     -0.193932+0.25556im      0.0227465-0.0250047im     0.0355778+0.0517209im     0.02449+0.091499im      -0.215774-0.0856893im       0.18964+0.0198677im     -0.181206-0.00846616im   0.0495571+0.0952354im    -0.0425738-0.0411418im      0.047042+0.197055im      0.0442986-0.101783im      0.173521-0.143742im      -0.106225+0.143767im       0.333219-0.308259im        -0.18131-0.05291im      -0.0876801-0.161549im      0.0642499+0.0339828im      0.121664+0.122745im     -0.128173-0.15031im        0.153302-0.0197902im   -0.00901118-0.016121im      -0.155857-0.0890881im     -0.250558-0.00813923im   0.0721075-0.154668im    -0.00665903-0.0479871im   -0.00275854-0.0906882im  -0.0827387+0.0560085im
 -0.0723184+0.112304im      -0.00776086-0.093571im      -0.103413-0.114403im     0.00124359-0.168526im     0.0241906-0.175216im     -0.0451903+0.00659951im   0.0837895-0.172519im      0.0931673+0.0695762im   0.0331165-0.0684329im     -0.156421-0.0910527im    -0.0217254-0.0376317im       0.21237+0.0927055im     0.260476-0.124851im     -0.0652852-0.132862im      0.0333324+0.0440151im    -0.0302936-0.146361im    -0.0900208+0.0080688im      0.138585+0.109279im       0.054055+0.119693im        0.351513-0.144342im      -0.102466-0.126004im      -0.323763-0.123445im      0.0596763-0.0492368im    0.0693582-0.112573im       0.128247-0.195503im        0.01214-0.0096931im     0.0546419+0.159127im     -0.0529667-0.0608532im    0.0405682+0.0985343im     0.0963968+0.0703817im     0.0524916-0.213663im    0.0744572+0.269218im
  0.0810107-0.0132577im    -0.000645297-0.0095317im    -0.0605714+0.0154607im    -0.0399558+0.163688im     0.0508718-0.0078237im   -0.00555886+0.187065im      0.189205+0.114055im       0.120435+0.0474284im  -0.0847801-0.130254im      0.0252058+0.444546im      -0.103001-0.160866im      -0.109692+0.183621im      -0.14862-0.079638im       0.204646+0.0394168im     0.0566188+0.227563im      0.0114906-0.0169408im   -0.0676832-0.0767191im      -0.16602-0.0219156im    -0.0203381+0.273555im       0.0374998-0.139705im       0.305101-0.03985im      -0.0907871-0.0439931im      0.158942+0.103994im     -0.134857-0.105306im       0.194945+0.0156261im     0.0776295+0.0570021im    -0.0559588+0.0588215im    -0.0308922-0.149812im    6.79184e-7-0.0360094im     0.0434464-0.0312921im    -0.0683575+0.01969im      0.170888-0.0699602im
  -0.128648+0.10153im        -0.0413211+0.142212im       0.224562-0.154986im     0.00869552-0.139802im    -0.0944265-0.0572942im      0.113547-0.0684678im   -0.0650821+0.0611219im   -0.00013368+0.0439399im   0.0410358-0.210587im      0.0224982-0.0835177im     -0.304864+0.0429642im     0.0227391+0.0503261im    0.0146768-0.036222im      0.0280903-0.0847141im      0.113486+0.0126068im     -0.200963-0.0447176im    0.0589182-0.00220913im   0.00706082+0.0933773im     -0.062306-0.0346664im      -0.233755-0.0108615im     0.0137141+0.00052876im     0.185053-0.312092im       -0.22832+0.0238567im   -0.0820583-0.024775im       0.124239-0.0361151im      0.183568+0.249355im      0.0130682-0.194737im     0.00929802+0.0143853im     0.266623+0.0252403im      0.240022-0.0337863im    0.00738953+0.0553176im    0.227493+0.0296154im
 -0.0571475+0.038601im        -0.105311-0.137365im     -0.0101132-0.241191im      -0.154929-0.160679im    0.00289597-0.0415987im      0.014471+0.0550148im    0.0881081-0.0166205im      0.110494+0.0487217im   -0.114651+0.0808704im     -0.135185-0.0177072im    -0.0620389+0.0883701im    -0.0676889-0.178364im      0.117061+0.0944663im     -0.157622+0.108917im     -0.0133115+0.139422im      0.0528804+0.0294051im     -0.31236+0.0292973im     -0.329396-0.0521633im     -0.119949-0.0240929im      0.0100975-0.20679im       -0.167705-0.0765149im      0.017004-0.0668104im      0.214577-0.23051im      -0.047547+0.25153im        0.022214+0.128203im     0.00857937+0.113071im     -0.0351904+0.0617982im      0.145652+0.0767279im     0.118129+0.0946662im    -0.0240307-0.00754662im   -0.0235781+0.257551im   -0.0513253-0.186308im
  -0.108937-0.0307462im       0.0550966-0.025569im     -0.0274328+0.163106im       0.193172+0.0256542im    -0.126687-0.0790707im     -0.115044-0.0614166im   -0.0709092-0.0431333im    -0.0202676+0.298706im     0.137185+0.118619im     -0.0990296-0.0051495im     -0.114033+0.0391728im     0.0880248+0.203781im    -0.0692003-0.20215im       -0.198018+0.203086im    -0.00354104-0.00333129im     0.200241+0.0806201im   -0.0634191+0.137162im     -0.0611917+0.117828im     -0.0683011+0.0294355im      -0.129766-0.155711im       0.108017-0.0117624im      0.121296-0.256171im       0.153933+0.00600299im   0.0992573-0.154034im      -0.186574-0.125738im     -0.0415092-0.280186im       -0.11659-0.00703931im    -0.123021+0.139801im    -0.0739199-0.0262901im      0.221712+0.00870976im   -0.0114571+0.134585im   -0.0383803-0.110743im
   0.275284-0.0411502im        0.286794-0.228791im       0.083302+0.174458im      0.0874031-0.0233479im     0.106778-0.192829im      -0.194041-0.0928983im     0.053503-0.00662053im      0.21343-0.0217142im   -0.092452+0.0486716im     0.0806562+0.0311153im    -0.0068083+0.00146811im    -0.175095-0.246692im      -0.16132-0.172841im     -0.0347935-0.04274im       0.0299841+0.00434886im    0.0620016-0.169482im      0.146277+0.00391337im   -0.0520044+0.152815im     -0.0370091-0.215572im       0.0681874+0.0166516im     -0.217935+0.0742674im     0.0729769-0.144142im      0.0491358+0.0550051im   -0.0513802+0.0287158im      0.250109-0.139986im      0.0833214-0.0572369im      0.137386-0.0835449im      0.103579-0.0478657im   -0.0934847+0.0200739im     0.0238432-0.123401im      0.0156901+0.187093im    0.0510129+0.117927im
  -0.116694-0.000636403im     -0.297621+0.0183897im     0.0251777+0.108426im      0.0732691-0.104215im      0.123925+0.0516609im    -0.0234411+0.0503557im   -0.0822524+0.0191782im      0.101079+0.0374103im   0.0424212-0.0766589im     0.0724075+0.125912im    -0.00172289-0.135147im      0.0475431-0.110716im      0.016475+0.0149204im    -0.0610866-0.0422152im    -0.0430778+0.0271278im    -0.0272172-0.211213im     -0.102477+0.0197224im     0.0225385-0.0686352im   -0.00221427+0.0826833im      -0.192997+0.0576247im     -0.171022-0.0196424im   -0.00396192+0.0815856im      0.197095+0.304733im      0.229618+0.251689im    -0.00445431+0.147281im       0.343068-0.21772im      0.00720344-0.117135im      0.0888944+0.0436156im    -0.192722+0.0963173im      0.176731-0.00501234im     0.178579-0.197845im     0.081693-0.00991714im
  0.0160706+0.183372im         -0.11447+0.0565922im      -0.05311+0.108796im     -0.0714179-0.067283im     0.0440682-0.136172im       0.235305+0.188721im     0.0990886+0.0966009im     -0.140184-0.0980322im    0.234138+0.167578im     -0.0938297-0.026877im     -0.0728685+0.21717im      -0.0137138-0.0605676im   -0.0322294-0.0766226im      0.225349-0.0919775im     0.0623183-0.100767im    -0.00778215+0.104087im    0.00941844+0.0687453im     0.0737554-0.18341im       -0.171084-0.029909im        0.066681-0.0971682im    -0.0350816-0.191549im       0.033651-0.00595077im     0.213742+0.285253im      0.053009-0.213094im       0.111522-0.0701428im    -0.0740384-0.00402571im     0.232776-0.124432im      0.0342511+0.124286im     0.0330094-0.021147im      -0.117823-0.0249481im      0.239126+0.189861im   -0.0633182-0.0327178im
 -0.0120194-0.176456im       -0.0766644+0.0943822im     -0.115111+0.00825228im   -0.0356047-0.0273095im     0.107398-0.114436im      -0.017208+0.133478im    -0.0554458-0.0597221im    -0.0909644+0.060734im    0.0957635-0.0407916im     -0.108342-0.183143im      -0.124506-0.00648746im     0.162252-0.0942391im    -0.142308+0.110962im     -0.0630583+0.0313618im        0.1397+0.0912572im      0.284401+0.186368im    0.00297212+0.0318145im    -0.0764304+0.264647im     -0.0671536+0.0213412im     -0.0632967+0.114691im       0.154593-0.0510417im    -0.0428043+0.226333im     -0.0383317+0.060937im     -0.164076-0.0079672im      0.046968-0.0920754im     0.0898223-0.143421im     -0.0678715-0.0697638im      0.433881-0.0206166im     0.101794+0.0943887im     -0.163967-0.0417945im     -0.103756-0.0196472im     0.18088+0.222269im
  -0.022392+0.0515424im        0.134372-0.0691935im      0.202304+0.0929594im    -0.0468168-0.0102145im     0.134419+0.333684im     -0.0709876-0.0033719im     0.111404+0.0570572im    -0.0736976-0.107339im     0.112181-0.0489393im     -0.104914+0.0504827im     -0.176529-0.190254im      0.0810999+0.00383483im  -0.0298769-0.00583736im   -0.0786659+0.00773112im    0.0293214+0.0768107im     0.0319518-0.108237im    0.00569149-0.0439043im    -0.0291879+0.0707293im     0.0520899+0.0932501im       0.116509+0.0438654im    0.00816943+0.0700009im    0.00970757+0.0854824im       0.16849-0.00142072im   0.0485485+0.154726im      -0.173193-0.144844im      0.0545215-0.116732im       0.186191-0.108409im     -0.0753188+0.0539904im     0.519441-0.246295im     -0.0311486-0.0339749im     0.0186227+0.0415335im   -0.235795+0.106104im
 -0.0303938-0.0968061im       0.0114505-0.0424897im    0.00288229+0.0800308im     -0.121508-0.0652919im      0.11586+0.0772653im     0.0280364+0.127671im    -0.0840493+0.0266139im     0.0658509-0.0708641im  -0.0273983+0.0735535im      0.137981+0.0122522im      0.186475+0.15189im        0.211091-0.0315762im    0.0840195+0.0730503im     -0.133066-0.0929787im      0.104441+0.0860917im    -0.0247247+0.099941im    -0.0494041-0.0429398im     -0.171642-0.226862im      -0.175718-0.0212345im      -0.164562-0.00129014im    0.0477173+0.0226301im      0.134539-0.0327108im    0.00795059+0.0668917im    0.0128301-0.0481431im     -0.078645-0.187227im      -0.133787+0.0494499im   -0.00912944+0.162788im    -0.00664994-0.431561im    -0.0147112-0.112758im       0.339543-0.194347im      0.0451451+0.0318604im  -0.0920047+0.2962im
  -0.082506-0.0691437im       0.0318376-0.0380434im    -0.0646379+0.127166im       0.180636-0.00748158im    0.215559+0.00506341im    -0.215627+0.0132458im    -0.107375+0.10605im         -0.1944-0.097334im    -0.237737-0.0787619im     -0.149884+0.0522297im     0.0714638-0.0545701im     0.0553885-0.146897im    -0.0676582+0.0881062im   -0.00585096-0.0338256im    -0.0708795-0.0447596im     -0.100701+0.237393im     -0.154656-0.0481216im      0.148992+0.209442im     -0.0828131-0.0131474im      -0.073269+0.00733298im    -0.048827-0.0301525im     0.0948176+0.0257895im      0.120505-0.227484im    -0.0990281-0.238787im       0.129409+0.0528415im     0.0090194+0.0663623im      0.113649+0.141004im     -0.0163751+0.00610304im    0.125997-0.0448242im      0.145622+0.0444533im      0.365346-0.150819im    0.0836051-0.223203im
   0.024481+0.167967im         0.174968+0.136717im       0.148855-0.0551825im     0.0678163-0.0325453im    0.0111797+0.269503im       -0.19331+0.0835404im    0.0925944-0.23156im       -0.131132+0.0883111im    0.199648+0.154167im        0.19023-0.00101139im     0.193431-0.147997im      0.0596766-0.122085im      0.122154+0.0926668im      0.112552+0.143644im     -0.0133137-0.00330814im   -0.0655006+0.0999002im    -0.100891+0.0943356im   -0.00399244-0.136895im       0.113787-0.018502im       -0.100507-0.154341im      0.0211224+0.0532348im     -0.044058-0.193462im      -0.057433+0.0216901im   -0.0279593+0.112871im       0.149981-0.125991im       -0.11903-0.162554im      0.0412492+0.0190013im      0.129699-0.0660836im    0.0193947-0.0238467im     -0.133823+0.0868235im        0.1157+0.0267366im    0.383254-0.0573124im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.03544266768521617 - 0.33353078214909415im
  0.052993909340749004 + 0.031794706643125795im
   0.05907039819965742 - 0.16680094859239175im
   0.24021105308127713 - 0.00894616089940345im
   0.38587334788087824 + 0.0im
  0.054107894616461275 - 0.05149348721014632im
   0.06427361719703244 - 0.007787281482241892im
  0.021939319737759408 + 0.11439196955431011im
  -0.07436236500560277 - 0.12229031978269693im
 -0.062418990927269664 - 0.001013140946981888im
  -0.06696972158905157 - 0.02048757765147794im
 -0.014844558745318356 + 0.07043147325998846im
    0.1696178908504549 + 0.16475896416159436im
  -0.11363573397821433 - 0.003146321170441807im
    -0.036648162961214 - 0.10437184877563087im
    0.1226823773092233 + 0.038969628296816494im
 -0.029057954841163004 - 0.0033629969574011064im
  0.021855131432135355 + 0.07610295290234431im
  -0.08031402698839739 + 0.022009697045610954im
  -0.03752949580102175 + 0.028511088399558016im
  0.014466642415071583 - 0.0035490543342827745im
   0.10711247151408743 - 0.10448979894377905im
   0.06601116633057007 - 0.04000812158356069im
   0.15053310222125255 + 0.09290880708330121im
   0.24478057046254198 + 0.2808329396474674im
  -0.20705840412160384 + 0.01844996687491192im
   0.13271912391608842 + 0.2553203774297052im
   0.06745602504396046 - 0.03773062232455085im
  -0.17092077872945374 + 0.12946790498532068im
  0.056729497541270636 + 0.13165458421496598im
   -0.2488858174020997 - 0.019436690021305228im
   -0.1190414944059767 + 0.017339454840884783im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Wednesday 1 June 2022 21:10">Wednesday 1 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
