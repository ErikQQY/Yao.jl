<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.0161272-0.160928im     -0.101594-0.118369im     -0.0603183-0.0786494im     0.0280631-0.100867im      0.0797881+0.0602574im      0.239335-0.0722865im     0.0451973+0.0113682im     0.0305619+0.196215im     0.0168551+0.107396im       0.064749+0.0772405im    -0.124592+0.0454127im     0.0989325-0.0124071im      0.065302+0.0992501im      -0.104071+0.095731im     -0.0647596-0.083038im       0.145922+0.0346691im    -0.0268729-0.308697im     -0.180318-0.223612im       0.0712004-0.371475im        0.173355+0.00916783im      0.14001+0.069948im    -0.00903682+0.0425623im     -0.125274+0.0628736im    0.0893211+0.0716132im   -0.0179651+0.257554im       0.136189-0.0505081im     -0.141266-0.018565im        0.20669-0.0547385im   -0.00718595+0.150723im       0.0573456-0.16831im      -0.144907+0.00149358im       0.186177-0.150733im
   -0.011303+0.0280123im    -0.209056-0.392529im      -0.212454-0.0282323im    -0.0151864-0.0954063im    -0.0411512+0.0723095im    -0.0535567+0.0786163im      0.147543-0.0150582im   -0.00655646+0.168032im      0.111682+0.152564im     -0.0301245-0.0365302im    -0.140012+0.11667im     0.000220424+0.26604im        0.139288+0.091659im       0.0280809+0.00131083im   -0.0966025-0.0691231im    -0.0895792-0.0664898im    -0.0109297+0.0554436im   -0.0492988-0.0614345im     -0.0688107+0.0850367im       0.140772+0.0390926im       0.15348-0.120169im      0.0216339+0.0419565im      0.042595-0.110418im      0.114289-0.266586im      0.101617+0.0104933im    -0.0734028+0.228307im      0.0944863-0.0186405im     0.0882542+0.0283777im      0.024043-0.237665im       0.0408055-0.0570146im     0.196107-0.10748im         -0.164867+0.276775im
 -0.00749691-0.173577im    0.00453767-0.0328662im     -0.169247-0.183943im     0.00443711-0.10904im      -0.0511015-0.16717im       0.0473019+0.0600612im      0.134213+0.0289342im     -0.127122+0.0309869im    0.0191419-0.179303im       0.132051-0.216508im      0.065928-0.0866548im      0.153794-0.196945im     -0.0215894+0.00421511im    -0.0921774-0.118709im       0.113697-0.111386im    -0.00940553+0.0699658im      -0.14869+0.0534385im    0.0319439-0.168321im        0.175703+0.299774im      -0.0783229-0.068044im       0.313354-0.0143843im    -0.0134333-0.153556im      0.0678357+0.117787im    -0.0371629-0.117463im     0.0528351-0.099797im    -0.00379666-0.0418084im     -0.108267+0.358035im     0.00460204-0.00758282im    -0.166559-0.0462388im      -0.038461-0.137491im     -0.203159+0.0846868im      0.00396521+0.0508231im
  -0.0600409+0.0937872im   -0.0730008+0.00658529im    0.0187218-0.0725426im     0.0924835-0.339801im     -0.0855635-0.0625792im    -0.0883712-0.0306135im     0.0161835-0.0427114im    -0.0288932-0.142908im    -0.0807775-0.0507136im      0.237865-0.00153428im   0.0444045-0.324566im       0.159563+0.00419197im   -0.0645843-0.162665im       -0.177973+0.0322749im     0.0296431-0.0782468im     0.0801892-0.154133im       -0.22354+0.0345185im   -0.0629038-0.033824im       0.0160618+0.0576041im      -0.130948+0.168497im      -0.170311-0.0209082im    0.00738693+0.0310561im     -0.154237+0.0494im       0.0571215-0.148441im     0.0216331+0.0548402im     0.0153388+0.109612im       0.214815-0.185614im      0.0437257-0.0543841im    0.00602862+0.271626im       0.0471685-0.151327im        0.1863-0.286271im       -0.0295898-0.0722877im
    -0.14639-0.0806736im     0.109602+0.0672031im     -0.216712-0.0888198im      0.191318-0.00808266im     0.183873-0.2029im        0.0697303-0.0493997im     -0.171639-0.0413103im      0.303834+0.111849im     0.0177868+0.0532106im      0.049181-0.00962272im  -0.0739677-0.0908608im    -0.0576414+0.0619719im      0.087616-0.191791im     -0.00859281+0.0807664im      0.261874-0.0237775im     0.0536506+0.177198im       0.158559+0.235657im     0.0164607+0.0827997im       0.187984-0.0624608im      0.0986134-0.00355342im   -0.0977112+0.128992im      0.0737534-0.0415323im      0.220004-0.0173914im   -0.0381368-0.113757im     0.0568661+0.10823im        0.068466-0.0371638im    -0.0926023+0.186357im      0.0764299-0.0201303im      0.195613-0.081522im      -0.0298161+0.0813223im     0.199676-0.251278im        0.0711087-0.0208781im
  -0.0360062+0.0105775im     0.118818+0.0368523im     0.0299056-0.0963498im     -0.196302-0.0430668im      0.112644-0.0167497im      0.088811-0.238906im      -0.138466+0.0612917im     0.0560489+0.030537im    -0.0211716+0.0132167im     0.0696779+0.0112604im    0.0180101-0.0364445im     0.0646648-0.0545311im       0.16044+0.0872775im      -0.115596+0.0939983im     0.0928966-0.138214im       0.195453-0.0933879im    -0.0819221-0.11781im     -0.0432853+0.123049im        0.012845+0.0455181im      0.0809483-0.0684059im     -0.109591+0.00983588im    0.0255136+0.260758im     -0.0605245+0.217902im     -0.241203-0.211203im     -0.242412-0.0714283im    -0.0426016-0.0556001im      0.174175-0.0485133im     -0.053518+0.299112im      0.0134912-0.320897im         0.22841-0.0393361im   -0.0695918+0.131218im       -0.0174155+0.155554im
  -0.0558229-0.201118im    -0.0804643+0.041149im      -0.207213-0.0541155im      0.142147-0.0682978im    -0.0252791+0.0875597im   -0.00341401-0.0934056im    -0.0283436-0.215575im      0.0465023-0.0107892im   -0.0603134+0.151378im      -0.138462+0.133624im      0.239029+0.0174629im    -0.0954207-0.182087im      -0.182598-0.00183895im     -0.134465-0.0655855im     -0.196562+0.0923896im     0.0797179-0.157293im       -0.15788+0.121435im      0.360494-0.00893236im     -0.138259-0.0895805im      0.0539069-0.000356751im  -0.0530719+0.0979195im     -0.335643+0.0704325im   -0.00658131-0.13365im       -0.13545-0.0297641im   -0.0377241-0.0163499im     -0.203068+0.0225813im     -0.178991+0.0319493im      0.130475+0.0680347im       0.05169-0.065943im       0.0179897-0.0939637im    -0.105726-0.114383im     -0.000448636+0.0903352im
  0.00187368-0.0169758im     0.172986+0.162049im      -0.217033-0.128322im     -0.0761855+0.0992604im     -0.157225+0.0945687im     -0.120937-0.196199im     -0.0833446-0.261633im     -0.0308493-0.110096im      0.126222-0.00770753im    -0.147597-0.173685im     -0.105877-0.00979571im   -0.0713145+0.0654892im     0.0652911-0.0136203im      -0.162343-0.291983im       0.184855-0.0260893im    -0.0400203+0.172551im     -0.0901188-0.193597im    -0.0822215-0.174459im       -0.136334-0.084659im        0.151239+0.0615251im    0.00156186+0.0174183im      0.175602-0.0832671im     -0.058603+0.0328837im     -0.18279+0.0429058im    0.0348529-0.168213im      -0.115586+0.146588im     -0.0568438-0.122048im      0.0986345-0.221266im     -0.0567814+0.0668061im       0.176392+0.115137im       0.09068-0.00285513im     -0.0596709+0.00762002im
   0.0819935-0.0497654im    -0.049085-0.0544819im      0.014994+0.0447719im     0.0629356-0.398678im      0.0757599+0.137044im      0.0253564+0.114056im      -0.206946-0.224429im    0.000472783-0.0854244im    0.0806167-0.3152im        -0.167106-0.102108im    -0.0110089-0.0554914im   -0.00393807+0.0838474im      0.151078-0.162146im       0.0656422+0.132809im    -0.00468374-0.220623im     -0.0815521+0.0937188im    -0.0529807+0.0203177im     0.256608+0.0321893im   -0.000674191-0.0836296im      0.0938477+0.0972666im     0.0301234-0.00379166im    0.0804614+0.107844im     -0.0307991-0.0662955im    0.0331256+0.0613376im     0.209414-0.0278091im     0.0479599-0.0440365im     -0.124911-0.0856838im    -0.0398913+0.238659im      -0.041128-0.0511772im     -0.0319218-0.0191909im    0.0654854+0.325865im        -0.011568-0.143941im
   0.0814785+0.0204834im     0.106383-0.094934im       0.139966+0.0281438im   -0.00628584-0.166002im     -0.0161308-0.0177767im     -0.131103-0.0219938im     0.0251589+0.125662im       0.135591+0.078656im     -0.151278-0.169258im       0.152928-0.364775im      0.264885+0.102327im      0.0284074-0.0465642im     -0.184738+0.207684im       -0.201258-0.106262im     -0.0561946+0.117894im      0.0839699+0.00970592im     0.162011+0.0328418im    -0.100937+0.177826im       0.0150246-0.0924266im       0.256028+0.0168116im     -0.194484-0.112577im       0.129054-0.0224813im      -0.11757-0.103912im     -0.026647+0.0682934im    0.0196276+0.104613im     -0.0592739+0.275059im      -0.175947+0.123224im      0.0857272-0.0138342im     0.0120288-0.100642im      -0.0753623-0.0516519im    0.0896176+0.0851455im       0.0314287-0.00886855im
   0.0731784-0.337721im       0.03625-0.0313045im     -0.222145+0.0996477im    -0.0460993-0.113603im      -0.172909+0.108059im      0.0144441-0.0381393im     -0.100872+0.0349956im     0.0349747-0.0326548im    0.0870223+0.231528im       0.112864+0.0630393im     0.196687-0.292948im       -0.12825-0.0952227im   -0.00208098+0.0204919im       0.275482-0.0623989im     -0.130731-0.179705im     -0.0461965+0.147532im      0.0872198-0.0252322im    -0.176303+0.224859im      -0.0727784+0.0517905im      -0.154542-0.0119022im    -0.0325829-0.00437224im      0.24215-0.191379im      -0.185948-0.107579im      0.112395-0.0385312im    -0.167369-0.027424im      0.0575866-0.0238335im     -0.056515-0.0416999im    0.00865371+0.0221541im       0.10954+0.000348051im  -0.00376876-0.0273511im   -0.0271403+0.0993269im       0.0912082+0.131623im
   0.0156304-0.0144435im   0.00264669+0.0224521im      0.027464-0.0547619im      0.219989-0.0429864im     0.0249191+0.215922im     -0.0199556-0.0685264im    -0.0968226+0.140755im       0.186219+0.0507005im    0.0223995-0.107785im      -0.042664-0.018481im     -0.221868-0.118081im       0.195498-0.125612im       0.105708+0.048868im        0.112685+0.00631051im    0.0941499-0.0305085im     0.0905797-0.383117im       0.145212-0.0493115im   -0.0166048+0.114669im     0.000471535+0.11198im     -0.000841159+0.0890387im     0.0274334-0.14442im      -0.0837542+0.00255127im   -0.0479044+0.0481122im    0.0264566+0.250471im       0.10839-0.18117im      -0.0419694-0.0853131im    -0.0938685+0.0645532im      0.284306-0.0855662im     0.0336828+0.16331im        0.0221617+0.178303im     -0.039356+0.017955im       -0.0497256+0.361223im
    0.102301-0.0924213im    0.0236606+0.0161078im     0.0657291-0.0506422im     -0.193099-0.0425452im    -0.0265139+0.411865im       0.062443-0.0520929im      0.183068-0.0591463im      0.117729-0.19307im     -0.0312518+0.0724743im      0.206314+0.0618631im    0.0148792+0.137754im     -0.0357269-0.0134326im    -0.0796556-0.255061im       -0.072647+0.00501637im      0.12668+0.105149im       0.175866+0.180319im     -0.0326595+0.0317329im     0.101661+0.190794im       0.0886373-0.0207186im     -0.0375254+0.0381558im      0.353902+0.0307463im     0.0634722+0.203099im      0.0668825+0.0480506im    0.0383221+0.255653im     -0.044122-0.0390113im      0.122136+0.131002im         0.1539+0.0890349im       0.04436-0.0286165im     0.0507609-0.0599739im      -0.111296-0.0739039im    0.0873184-0.0934473im      -0.0914589+0.0695492im
    0.237195-0.158141im   -0.00556225-0.169248im       0.121998-0.199057im      -0.062011+0.119638im       0.216839-0.0364017im     0.0647683+0.182723im      -0.175673+0.00588041im     0.182999+0.0244007im     0.232173+0.104567im     -0.0320242-0.0848857im   -0.0610463-0.147054im       0.153717+0.0854648im     -0.164195-0.156304im    -0.000492648-0.080933im     -0.0967842+0.00276587im   -0.0107222-0.065727im     -0.0863145+0.0435593im    -0.118723-0.00896774im    -0.0666498+0.0238592im      0.0153683-0.0409995im    -0.0329393+0.0505945im     -0.111944-0.0617379im     0.0990538-0.0639516im   -0.0881903+0.0429104im   -0.0125121-0.157655im      -0.159643+0.280842im       0.319191+0.0301781im      0.104247+0.021908im       0.134412+0.0320215im      -0.053271+0.0536745im    -0.159985+0.136835im         0.142073-0.242056im
   -0.173134+0.172869im     -0.215706+0.145438im         0.1158-0.252958im       0.109083+0.0720426im    -0.0317374+0.0313531im    -0.0976853+0.0384069im     0.0653899+0.0709556im    -0.0298552+0.111871im      -0.12604-0.0833411im     -0.144603+0.0385121im   -0.0705462-0.164924im      -0.103305+0.0279856im     -0.051006-0.124096im       0.0185043-0.264193im     -0.0810804-0.218193im     -0.0327701+0.0369207im      -0.24181+0.185981im     -0.130983+0.0304984im     -0.0410793-0.189289im      -0.0526085-0.0502601im      0.034619-0.0283261im      0.149326+0.0968191im     -0.198303-0.0313498im    0.0520592+0.172238im     0.0041022+0.135072im       0.131377+0.111089im     -0.0121824+0.147975im      -0.024943+0.121661im      0.0643808-0.251683im       0.0287268+0.193112im     -0.202173-0.0853985im       0.0606871+0.0743538im
   0.0361066+0.010117im     0.0993827-0.0334874im     -0.148412+0.18279im        0.149708-0.123053im       0.146878+0.151792im      -0.009714-0.0681915im     0.0316049-0.0994179im     0.0164708+0.164514im    -0.0652492-0.132562im       -0.16894+0.120147im    -0.0461452-0.153087im       0.117198-0.0658915im     -0.320734+0.0424556im     -0.0320444-0.158398im      0.0349647+0.152361im      -0.298436-0.131801im      -0.026215-0.322486im     -0.128011+0.10355im      -0.00631272-0.00132383im     0.0342625-0.105937im       0.111368+0.0850626im       0.20327+0.0190684im      0.163251+0.0626532im   -0.0456498-0.0583432im   -0.0908512+0.073887im     -0.0127083-0.0863441im      0.125903+0.0406022im    -0.0498767+0.205939im     -0.0907367-0.0607614im      -0.225022+0.0574775im    0.0550627-0.16319im        -0.0998073-0.0779934im
    0.167115+0.0412601im    0.0911533-0.0657374im     0.0319808-0.181764im     -0.0555443-0.0436775im     0.0707012-0.0425606im      0.225203-0.125866im    -0.00910462+0.0084463im     -0.101338-0.014972im      0.154903-0.283055im      0.0697577+0.133864im    0.00773838+0.00461716im    -0.576648+0.00245382im   -0.0761538-0.0151628im        0.10896+0.0260536im     0.0277247-0.0871777im    -0.0750941-0.0699119im     0.0543015-0.0567948im    -0.133023+0.130279im       -0.126203+0.0246043im      0.0668817+0.00627343im   -0.0532183-0.127766im       -0.24393-0.0771059im     0.0271141+0.0595741im   -0.0954651-0.0425099im    0.0968347-0.00273413im      0.18239+0.148878im      -0.017216+0.0696795im     0.0795669+0.0565005im     -0.200003+0.0912465im    -0.00656792-0.0684939im    -0.023021-0.203671im       0.00550605+0.0373344im
  -0.0251071-0.0670781im    0.0713235-0.0896036im      0.187272-0.128957im        0.16025-0.206924im     -0.0392929-0.0268767im    -0.0537358-0.35848im        0.102885-0.0192217im      0.137081+0.0183928im    0.0335152+0.0723953im    -0.0717324-0.00839353im   -0.189091+0.130504im     -0.0925282-0.0150483im   -0.00758466+0.0138122im     -0.0891802-0.0202889im    -0.0827933+0.0126705im      0.135934+0.0883392im     0.0410902+0.0600886im   -0.0260294-0.294101im      -0.0425198+0.161904im      -0.0901029-0.189663im     -0.0850519+0.0626113im     0.0222791-0.145815im     -0.0356195+0.0492683im    0.0560775+0.0803047im    0.0344609-0.173346im      0.0514543-0.000645051im  0.00177434-0.234873im      -0.176588+0.145613im      0.0347268-0.0686354im      -0.407326-0.0153795im     0.034193+0.000753265im       0.21035+0.114172im
     0.22638-0.0547853im    -0.043012-0.0959172im     0.0611383-0.00290043im    0.0209337+0.0591416im     -0.169003+0.0237058im     -0.110836-0.133855im       -0.17793+0.06031im      -0.0307651-0.102192im     0.0964091+0.144009im      0.0516388+0.0035321im    -0.284149+0.0243831im      0.197407-0.0248678im     -0.107973+0.0595371im      0.0131394-0.0688241im      0.172605-0.0561653im    -0.0843806+0.0297994im     -0.075728+0.131745im     0.0949591+0.0440478im      -0.128568-0.318946im       -0.108275+0.0398976im     -0.138509-0.074012im      -0.107338+0.174661im      0.0353258+0.0191532im    0.0596211-0.235139im     -0.178346+0.0175948im      0.140477+0.0389297im     -0.158473+0.287186im       -0.13528+0.00871767im    -0.279969+0.0851501im      -0.160308+0.0163925im      0.11827+0.0681469im       0.0435528+0.0455048im
   -0.101728-0.0929446im     0.303501+0.104645im       0.160942+0.0720419im   -0.00686731+0.00535469im   -0.0397756-0.129536im      0.0433688+0.00302541im   0.00889937-0.14217im       -0.173562+0.294181im     0.0934615+0.205094im     -0.0434173+0.0123218im   -0.0557365+0.177029im      0.0537586-0.0155995im    -0.0262204-0.0184232im       -0.10213+0.0471366im     -0.146069-0.268045im     -0.0438605-0.130894im    -0.00394533-0.125118im      0.129638+0.206558im        0.102322+0.136317im       -0.248191-0.0508049im     0.0407233-0.0672678im     0.0801655+0.20748im       -0.164246-0.0563995im   -0.0404781-0.0449448im     0.147721-0.13606im        0.129016+0.176123im      -0.100151+0.0691067im      0.165262-0.102154im      0.0111508-0.0385846im     -0.0589928+0.0902887im     0.111951-0.0958221im       0.0181461-0.198867im
  0.00550284-0.113297im      0.133374+0.26913im      -0.0916983-0.0671605im     0.0714624+0.0440788im    -0.0368389+0.0570517im       0.03372-0.0078586im     0.0219102-0.0123882im      0.123599-0.361412im    -0.0111794+0.0865012im     0.0165252+0.0585613im   -0.0929921+0.0943008im      0.119608+0.185016im       0.041334+0.294626im        0.214803+0.0824243im     -0.187009-0.0278488im    -0.0708796-0.0877243im     -0.157974-0.0335933im    0.0118082-0.0978151im       0.228571+0.0678884im       0.122082+0.00200496im   -0.0467181-0.24865im       0.0318306-0.121699im     -0.0391391+0.0453612im   -0.0877828+0.113816im     0.0699017+0.113737im    -0.00622632+0.190509im     -0.0106931+0.19553im        -0.13952+0.290045im       0.079901+0.0464664im      0.0226006-0.0655028im    0.0455839-0.138819im       -0.0417991-0.114606im
    0.144449+0.166593im    -0.0936522-0.276086im      -0.126378+0.107252im     -0.0942776+0.138451im     -0.0509918-0.0253086im     0.0929813-0.183459im       0.224502-0.0254389im    -0.0825325-0.110043im     0.0250205-0.0854386im     0.0528186+0.277083im     0.0199969-0.10883im       0.0809071-0.044091im     -0.0111301-0.109564im       -0.229197+0.00529014im    0.0750663-0.0172723im    -0.0337558-0.0915679im      0.140294+0.0132036im     0.167998-0.090986im      -0.0304789-0.0194273im     -0.0985833-0.0536239im    -0.0714798-0.193324im       0.167017-0.115984im     -0.0340067+0.0663097im    -0.188147-0.0243141im     0.093104+0.0356028im     0.0740869+0.0956661im     -0.158856+0.102701im      0.0390692+0.122945im       0.415878+0.0554027im      0.0338362+0.156385im   -0.00989182+0.151377im        0.0687987-0.0704864im
    0.234926+0.0970838im   -0.0267934+0.120381im     -0.0441632-0.0395385im     -0.100056+0.0805941im     0.0397523+0.0773761im     0.0019827-0.394288im     -0.0992983+0.0483853im     -0.115945+0.118385im     0.0472427-0.23699im      -0.0016619+0.0561981im    0.0971845-0.125207im        0.16244-0.0737686im      0.269926+0.249062im      -0.0373711+0.0407133im     -0.164138-0.0622735im    -0.0390753+0.00683749im    0.0793155+0.177817im      0.094018+0.0882354im      0.0501603-0.0803978im     -0.0165805+0.0544753im      0.257748+0.162262im     -0.0420211-0.0755046im     0.0108262-0.1364im        0.193901+0.00626936im   0.0251283-0.0241526im     -0.183866+0.0947401im      0.117865-0.00579978im     -0.10734-0.0878743im   -0.00611702-0.0610475im     -0.0133406+0.0483816im    0.0819584-0.204998im          0.18187-0.141422im
   -0.217616-0.0489603im   -0.0141736+0.113992im       0.190352-0.0676251im    -0.0582723+0.0829233im     -0.083383+0.104707im       -0.18899-0.154788im     0.00955452+0.108179im     0.00362793+0.0263476im     0.130371-0.0173577im    -0.0567702+0.0121853im   -0.0160786-0.0339607im    -0.0421339+0.0359689im      -0.19245-0.0217086im      -0.111696+0.13337im       0.0439908+0.166449im      -0.130083-0.0658687im    -0.0137104-0.00758175im  -0.0406777+0.0509262im       0.140736-0.104527im       0.0493018-0.080634im       0.095158+0.119215im      0.0869947-0.089317im       0.106111-0.316726im     0.0990515-0.216081im      0.207898-0.215212im       0.176801-0.0199124im     0.0146034+0.0500542im     0.0440863+0.235249im      0.0725435+0.184423im        0.302712-0.230588im   -0.00948056+0.126399im         0.095697+0.102495im
    0.219799-0.0580553im   -0.0749942+0.00724332im   -0.0355694+0.0957134im     0.0596266-0.134675im    -0.00617132-0.307108im      -0.164767+0.00385856im    0.0876828+0.191961im      -0.194804+0.0256114im      0.13655+0.146412im       -0.24759+0.153148im     0.0294752-0.0840616im    -0.0680601-0.0208638im    -0.0212381+0.0815084im      0.0562719-0.034652im      0.0769306+0.214303im       0.255037+0.0542037im     -0.195493-0.0127323im   -0.0201142+0.107707im       0.0602585+8.02618e-5im       0.21735+0.339471im      0.0605411-0.142863im       0.116687+0.114639im      0.0391805+0.0513741im   -0.0922819+0.131529im      0.113518-0.206985im      0.0870943-0.123768im      0.0474173+0.0339761im     0.0045296-0.00764601im    0.0391702-0.0925172im     -0.0197369-0.0348897im    0.0601287-0.0495121im        0.192716-0.0489162im
   0.0362522+0.0829809im   -0.0288924-0.189647im      0.0880414-0.144373im      0.0181027+0.0477916im     -0.010914+0.117453im      0.0550663+0.0342399im     -0.203545-0.00837363im   0.00664359-0.17535im     -0.0695406+0.221766im       0.132516-0.0276383im   -0.0375945-0.11681im      -0.0670567-0.122031im       0.157489+0.00587871im     -0.227708-0.247871im      -0.131983-0.00374337im    -0.125817-0.0916759im     0.0577397+0.0445068im    -0.125841+0.0120796im      0.0593944+0.176153im        0.170434-0.119676im      0.0931433-0.182982im     -0.0278781+0.118396im      0.0250928-0.282597im     -0.137441+0.0684242im    0.0657425-0.0225634im      0.121942-0.403539im     -0.0966695-0.0296994im    -0.0864586-0.0277232im    -0.0507013-0.0796567im      0.0289345-0.0494838im     0.131895-0.0915795im       0.0160467-0.217488im
   -0.184369-0.182912im      0.121326+0.00449802im    0.0821414-0.141538im      -0.154642-0.0566443im    -0.0402455+0.07713im      -0.0113618-0.178556im      0.0712116+0.187601im     -0.0260867+0.0590642im   -0.0256866+0.121605im       -0.16255+0.138262im      0.195874-0.0162932im      0.250527+0.131002im     -0.0790494-0.172361im      -0.0762965+0.133519im       0.194964-0.108965im      -0.348949+0.0777849im      0.101155+0.0503243im   -0.0693148+0.0143396im      -0.107713+0.0516668im      0.0841242+0.262093im     -0.0314514-0.189994im      -0.228716-0.128177im     -0.0427586+0.0304527im   -0.0862535+0.116232im      0.132902+0.202663im     -0.0667702-0.0808835im     0.0316046-0.0635273im    -0.0529659-0.077541im     -0.0993465-0.157644im      -0.0665496-0.0110093im    -0.028568+0.0351224im       0.0278129-0.00355445im
   0.0308648-0.07136im      0.0930547+0.0972575im      0.137684-0.26795im        0.121429-0.142407im     -0.0948135+0.00102206im    -0.106577+0.0896476im    -0.0476726-0.0491192im     -0.260746-0.102379im     0.0347437-0.102733im      0.0509468+0.201917im    -0.0545967-0.129074im      0.0548942+0.0566967im    0.00869506-0.0475119im     -0.0336156+0.197089im      -0.285093+0.127094im      0.0980422+0.0932461im     0.0380314-0.139349im     0.0083763+0.0671066im      0.0866353-0.0887767im       0.101587-0.215888im      0.0310777-0.081651im      0.0499609-0.0176608im      0.198602-0.0621348im    -0.185177-0.177237im    -0.0228276+0.203531im      -0.047117+0.00341578im    0.0475992+0.0182482im   -0.00629916-0.32954im       0.0593069-0.0647853im      -0.108666+0.180355im    0.00276503+0.140005im      -0.00699057+0.23485im
    0.250495-0.106015im      0.212662-0.00522201im    -0.114816+0.138128im     -0.0464558+0.250923im      -0.132885+0.114386im     0.00302884+0.0977399im    -0.0134619+0.160737im       0.169935-0.0645183im    0.0151624-0.181065im    -0.00907322+0.0463418im    0.0324623+0.0442308im    -0.0987121-0.0418948im    -0.0980657-0.0577676im      -0.083115+0.055719im       0.034969-0.0282608im     0.0178423-0.0612174im     -0.286987+0.0186801im   -0.0578882-0.165824im        0.214122+0.0438181im      0.0555074-0.0221579im    -0.0857281+0.11658im      -0.0569856+0.110672im      -0.286289-0.056526im      0.128248-0.220316im      0.282655+0.149949im    -0.00681452-0.179081im      0.0850817-0.0830448im      0.107993-0.0649513im    0.00106443-0.152784im       -0.139315+0.164192im     0.0507672+0.0300427im       0.0846795+0.0940992im
  -0.0796123-0.114536im     -0.194686-0.0937852im   -0.00039103-0.151245im      -0.053382+0.103539im        -0.1063-0.0788291im     -0.186608+0.107755im      -0.394288-0.11993im      -0.0204907-0.00584848im  -0.0875501-0.0452611im    0.00812527+0.251964im     0.0154763+0.16979im      -0.0518096-0.0802521im    -0.0276788+0.105256im      -0.0180629-0.232173im       0.128183-0.0282876im      0.021833-0.0767443im      0.230734-0.0849921im     0.034543+0.111691im        0.177687-0.0720749im     -0.0940729+0.000660209im   0.0229243+0.00235627im    0.0831367-0.0124744im    -0.0801582+0.286038im     0.0343497+0.00730163im    0.303551+0.0688481im     -0.134946+0.0604457im      0.139462-0.0503548im    -0.0895171-0.00754122im    0.0639035-0.00985387im     -0.117058-0.275525im    -0.0271787+0.0154861im       0.0125088+0.0382527im
 -0.00480546-0.0593581im    0.0509574-0.0237376im     0.0653231+0.0107087im    -0.0170708+0.0103199im     -0.311641+0.0423672im     0.0625186+0.0961543im    -0.0815301+0.0380612im     0.0579752-0.00974513im   0.0677653-0.150989im      -0.138561-0.173536im    0.00238727-0.0999008im     0.0315408-0.0199281im    -0.0796745+0.0836941im    -0.00701559+0.0756146im    -0.0195436+0.100703im     -0.0347834+0.214651im      0.0314704-0.0251474im    0.0244284-0.0512337im      -0.178605+0.0249044im      -0.190281-0.195189im      0.0146557-0.328754im     -0.0386993+0.230388im         0.2482+0.225265im      0.185319+0.0179392im    0.0148957+0.0527363im     -0.109546-0.0730958im    -0.0530846-0.0968395im      0.181263+0.0907545im      0.151112-0.100953im        0.191143-0.0652457im   0.00914649-0.260558im         0.244048-0.0578277im
  0.00642389+0.212648im     -0.153601-0.0291398im    -0.0205501-0.00135422im     0.215481-0.0846089im     -0.156429+0.214024im     0.00711889-0.20255im       -0.213946+0.129323im      -0.147136+0.104849im    -0.0756074+0.195997im     -0.0195873-0.0811605im    0.0688693+0.138075im      -0.053153-0.0504085im     -0.129863-0.0688412im        0.23574+0.050933im       0.179921+0.0337423im     0.0138325+0.0529518im    -0.0865744+0.0520016im     0.170065+0.0446759im       0.136862+0.213966im        0.249905-0.222826im      0.0695308-0.0620171im    -0.0272684-0.132302im     -0.0936426+0.150494im   -0.00161702-0.133376im     -0.065468+0.086861im      0.0482808+0.0995525im      0.125662-0.0541155im      0.155384-0.0528873im    -0.0018064+0.0594419im      0.0695572+0.152336im    -0.0432298+0.0952713im        0.060465-0.251892im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   -0.17189065267361434 + 0.09146818266004263im
    0.10387679668871967 - 0.1522121360284591im
  -0.028673076055800214 + 0.10445482195649852im
     0.1295140005400967 + 0.20782396545402249im
   0.020991553529533385 + 0.11859897349122224im
    0.08504234032051931 + 0.06751401057141507im
   -0.05674179055516507 + 0.12242800218828817im
  -0.056558803940408305 - 0.06364059054590397im
   -0.14181357806310096 - 0.11140522794450514im
   -0.08023015324934805 + 0.12680615325050032im
    0.33672819293599615 + 0.0im
    0.03226696893118811 - 0.011202309553492221im
   -0.26245903071947957 - 0.0267194173844464im
  -0.003511773217464861 - 0.042732124568423964im
  -0.016201444413041527 + 0.07004305842687233im
    0.19273246269817654 + 0.2210777563420832im
   -0.08409873876938402 - 0.0007251991927366776im
   -0.21528653528143085 - 0.012184231412846866im
 -0.0034383457379302375 - 0.11590585409852644im
    0.07788194985631922 + 0.25469871293392143im
    0.01787334647931168 + 0.05486628918101277im
    0.12279587164342064 - 0.2665962537094543im
    0.15283744961917195 - 0.10099265507919881im
    0.23968570421883534 - 0.018709147995862423im
   -0.09996504014786156 + 0.02849350259186884im
    0.05574135226565759 + 0.03817302929148362im
  -0.031692375386392496 - 0.10163149724410807im
    0.08256408907543333 - 0.014928837612051986im
   -0.09078766781184343 - 0.12647407461679225im
   0.041922777932082995 - 0.1306208375770753im
     0.0345421659870684 + 0.20498730986864283im
  -0.008843224509075409 + 0.1832336442654769im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.18 on <span class="colophon-date" title="Tuesday 31 May 2022 00:41">Tuesday 31 May 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
